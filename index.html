<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Piano Studio Smart - Gestione esami universitari con AI">
    <meta name="theme-color" content="#8b5cf6">
    <title>Piano Studio Smart - AI Enhanced Pro v3.0</title>
    <style>
        /* === VARIABILI CSS === */
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --primary-light: #a78bfa;
            --secondary: #06d6a0;
            --secondary-dark: #05c296;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1b3a;
            --bg-tertiary: #2d2f4f;
            --bg-card: #1e1f3f;
            --bg-hover: #252647;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #374151;
            --border-light: #4b5563;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6);
            --transition: 0.3s ease;
            --border-radius: 12px;
            --border-radius-lg: 16px;
        }

        /* === RESET E BASE === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === UTILITY CLASSES === */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .flex {
            display: flex;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }

        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }

        .hidden { display: none !important; }
        .loading { opacity: 0.6; pointer-events: none; }
        .required { color: var(--danger); }

        /* === COMPONENTI === */
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 3rem 2rem;
            margin-bottom: 2rem;
            border-radius: var(--border-radius-lg);
            text-align: center;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 0.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Navigation */
        .nav-container {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .nav-tabs {
            display: flex;
            padding: 8px;
            gap: 4px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            flex: 0 0 auto;
            min-width: 120px;
            padding: 16px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: all var(--transition);
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: all var(--transition);
            transform: translateX(-50%);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .nav-tab.active::before {
            width: 100%;
        }

        .nav-tab:hover:not(.active) {
            background: var(--bg-hover);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        /* Mobile Navigation */
        .mobile-nav-toggle {
            display: none;
            padding: 1rem;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: var(--border-radius);
        }

        .nav-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
            border-top: 1px solid var(--border);
            max-height: 60vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-dropdown.show {
            display: block;
        }

        .nav-dropdown .nav-tab {
            display: block;
            width: 100%;
            text-align: left;
            border-radius: 0;
            border-bottom: 1px solid var(--border-light);
        }

        /* Sections */
        .section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        /* Buttons */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 48px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        .btn-small {
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            min-height: 40px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all var(--transition);
            font-family: inherit;
            min-height: 48px;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        input[type="checkbox"] {
            width: auto;
            min-height: auto;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border);
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(139, 92, 246, 0.1));
            opacity: 0;
            transition: opacity var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            transition: width 0.8s ease;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Timer Display */
        .timer-display {
            font-size: clamp(4rem, 10vw, 5rem);
            font-weight: 800;
            color: var(--primary-light);
            margin: 3rem 0;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            text-align: center;
            transition: all var(--transition);
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .timer-display.break-mode {
            color: var(--secondary);
            text-shadow: 0 0 20px rgba(6, 214, 160, 0.5);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-large {
            max-width: 800px;
            width: 95%;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 6px;
            margin-top: 0.5rem;
        }

        .star {
            font-size: 1.8rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all var(--transition);
        }

        .star:hover {
            transform: scale(1.2);
        }

        .star.active {
            color: #fbbf24;
            animation: starPulse 0.5s ease;
        }

        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Session Items */
        .session-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all var(--transition);
        }

        .session-item:hover {
            transform: translateX(4px);
            border-color: var(--primary);
        }

        /* Subject Items */
        .subject-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all var(--transition);
            border-left: 4px solid var(--primary);
        }

        .subject-item:hover {
            transform: translateX(8px);
            box-shadow: var(--shadow-lg);
        }

        .subject-item.exam-completed {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        /* Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--bg-card);
        }

        .calendar-day {
            min-height: 120px;
            padding: 0.5rem;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-hover);
            transform: scale(1.02);
            z-index: 10;
        }

        .calendar-day.today {
            border: 2px solid var(--accent);
            font-weight: 700;
        }

        .calendar-day.has-sessions {
            border-left: 4px solid var(--primary);
        }

        /* Heatmap */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px;
            margin-top: 1.5rem;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all var(--transition);
            min-height: 50px;
            position: relative;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .heatmap-cell.empty { background: #374151; color: var(--text-muted); }
        .heatmap-cell.low { background: #ef4444; color: white; }
        .heatmap-cell.medium { background: #f59e0b; color: white; }
        .heatmap-cell.high { background: #10b981; color: white; }
        .heatmap-cell.very-high { background: #22c55e; color: white; }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: all var(--transition);
        }

        .tooltip.show {
            opacity: 1;
        }

        /* Notification Banner */
        .notification-banner {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            transform: translateX(500px);
            transition: all var(--transition);
            opacity: 0;
        }

        .notification-banner.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Backup Indicator */
        .backup-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            background: var(--success);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0;
            transition: all var(--transition);
        }

        .backup-indicator.show {
            opacity: 1;
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Toast Messages */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            font-weight: 600;
            max-width: 400px;
            animation: slideIn 0.4s ease;
        }

        .toast.success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .toast.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .toast.warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Specialized Components */
        .semester-badges {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .semester-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(139, 92, 246, 0.2);
            color: var(--primary-light);
        }

        .score-explanation {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            cursor: pointer;
            transition: all var(--transition);
        }

        .score-explanation:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .search-filter {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            background: var(--bg-card);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all var(--transition);
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Slot Items */
        .slot-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border);
            flex-wrap: wrap;
            animation: fadeIn 0.3s ease;
        }

        /* Year Content */
        .year-content {
            display: none;
        }

        .year-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Animations */
        .fade-in-up {
            animation: fadeInUp 0.6s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--bg-tertiary);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .nav-tabs {
                display: none;
            }

            .mobile-nav-toggle {
                display: block;
            }

            .nav-container {
                position: relative;
            }

            .container {
                padding: 15px;
            }

            .header {
                padding: 2rem 1rem;
            }

            .timer-display {
                font-size: 4rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal {
                padding: 1.5rem;
                width: 95%;
            }

            .notification-banner {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .btn {
                padding: 12px 24px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .timer-display {
                font-size: 3rem;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
            }

            .nav-container,
            .header,
            .btn,
            .modal-overlay {
                display: none !important;
            }

            .card {
                box-shadow: none;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }

            .section {
                display: block !important;
                opacity: 1 !important;
                transform: none !important;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: light) {
            :root {
                /* Light mode variables can be added here if needed */
            }
        }

        /* Focus Styles */
        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Selection */
        ::selection {
            background: var(--primary);
            color: white;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üöÄ Piano Studio Smart AI Pro v3.0</h1>
            <p>Il tuo assistente intelligente anti-procrastinazione - Ingegneria Aerospaziale - Universit√† Vanvitelli</p>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <button class="mobile-nav-toggle" onclick="App.Navigation.toggleMobile()">‚ò∞ Menu</button>
            <div class="nav-tabs" id="navTabs">
                <button class="nav-tab active" data-section="oggi">üåÖ Oggi</button>
                <button class="nav-tab" data-section="materie">üìñ Materie</button>
                <button class="nav-tab" data-section="curriculum">üéì Curriculum</button>
                <button class="nav-tab" data-section="esami">üìä Esami</button>
                <button class="nav-tab" data-section="piano">üìã Piano</button>
                <button class="nav-tab" data-section="pomodoro">üçÖ Pomodoro</button>
                <button class="nav-tab" data-section="calendario">üìÖ Calendario</button>
                <button class="nav-tab" data-section="statistiche">üìà Statistiche</button>
                <button class="nav-tab" data-section="helper">üéØ Helper</button>
                <button class="nav-tab" data-section="impostazioni">‚öôÔ∏è Impostazioni</button>
            </div>
            <div class="nav-dropdown" id="navDropdown"></div>
        </nav>

        <!-- Notification Banner -->
        <div class="notification-banner" id="notificationBanner">
            <div class="flex-between">
                <div>
                    <div style="font-weight: 700;">üìÖ Promemoria Esame</div>
                    <div id="notificationText">Hai un esame tra 7 giorni!</div>
                </div>
                <button onclick="App.NotificationManager.hide()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">√ó</button>
            </div>
        </div>

        <!-- Backup Indicator -->
        <div class="backup-indicator" id="backupIndicator">
            üíæ Backup automatico salvato
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sezione OGGI -->
            <section id="oggi" class="section active">
                <div class="card fade-in-up">
                    <h3>üåÖ Il Tuo Piano di Oggi</h3>
                    
                    <div id="smartPlanningAlert" class="card hidden" style="background: linear-gradient(135deg, var(--secondary), var(--secondary-dark)); color: white; margin-bottom: 2rem;">
                        <h4>ü§ñ Pianificazione Intelligente Attiva</h4>
                        <p id="smartPlanningMessage">Il sistema sta ottimizzando il tuo piano di studio.</p>
                    </div>

                    <div style="background: var(--bg-tertiary); border-radius: var(--border-radius); padding: 2rem; margin-bottom: 2rem;">
                        <h4 style="color: var(--primary-light); margin-bottom: 1rem;">üî• PROSSIMO TASK:</h4>
                        <div id="taskCorrente" style="background: var(--bg-secondary); border-radius: var(--border-radius); padding: 1.5rem;">
                            <div class="flex gap-2 mb-2" style="align-items: flex-start; flex-wrap: wrap;">
                                <span id="currentTaskMateria" style="font-size: 1.3rem; font-weight: 700; flex: 1; min-width: 200px;">Nessun task programmato</span>
                                <span id="currentTaskTime" style="background: var(--primary); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600;">‚è±Ô∏è -- min</span>
                            </div>
                            <div id="currentTaskDesc" style="font-size: 1.1rem; margin-bottom: 1rem;">
                                Aggiungi delle materie per iniziare a studiare in modo intelligente!
                            </div>
                            <div id="currentTaskMotivation" style="background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                üí° Il sistema pianificher√† automaticamente le tue sessioni di studio
                            </div>

                            <div id="taskOptions" class="hidden">
                                <h5>üéØ Cosa vuoi fare specificamente?</h5>
                                <div id="taskOptionsList"></div>
                            </div>

                            <button class="btn btn-primary" onclick="App.TimerManager.startTask()" id="startTaskBtn" disabled>üöÄ Inizia Subito</button>
                        </div>
                    </div>

                    <div>
                        <h4 style="color: var(--primary-light);">üìã Programma Completo di Oggi:</h4>
                        <div id="timelineOggi" style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: var(--border-radius); padding: 1.5rem;">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìÖ</div>
                                <p>Aggiungi materie con slot temporali per vedere il piano giornaliero</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sezione Materie -->
            <section id="materie" class="section">
                <div class="card" style="background: linear-gradient(135deg, var(--accent), #d97706); color: white; text-align: center;">
                    <h3 style="margin-bottom: 1rem;">üî• Studio Streak</h3>
                    <div id="streakNumber" style="font-size: clamp(3rem, 8vw, 4rem); font-weight: 800;">0</div>
                    <p style="font-size: 1.1rem; opacity: 0.9;">giorni consecutivi</p>
                </div>

                <!-- Filtri e Ricerca -->
                <div class="search-filter fade-in-up">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="searchMateria">üîç Cerca Materia</label>
                            <input type="text" id="searchMateria" placeholder="Cerca per nome..." onkeyup="App.MaterieManager.filter()">
                        </div>
                        <div class="form-group">
                            <label>üìä Filtra per Status</label>
                            <div class="filter-chips">
                                <div class="filter-chip active" data-filter="all">Tutte</div>
                                <div class="filter-chip" data-filter="studio">In Studio</div>
                                <div class="filter-chip" data-filter="completato">Completate</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <h3>‚ûï Aggiungi Nuova Materia</h3>
                    <form id="materiaForm" onsubmit="event.preventDefault(); App.MaterieManager.add();">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nomeMateria">Nome Materia <span class="required">*</span></label>
                                <input type="text" id="nomeMateria" required placeholder="Es. Analisi Matematica I">
                            </div>
                            <div class="form-group">
                                <label for="cfu">CFU <span class="required">*</span></label>
                                <input type="number" id="cfu" min="1" max="30" required placeholder="Es. 9">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="anno">Anno <span class="required">*</span></label>
                                <select id="anno" required>
                                    <option value="">Seleziona Anno</option>
                                    <option value="1">1¬∞ Anno</option>
                                    <option value="2">2¬∞ Anno</option>
                                    <option value="3">3¬∞ Anno</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="semestre">Semestre <span class="required">*</span></label>
                                <select id="semestre" required>
                                    <option value="">Seleziona Semestre</option>
                                    <option value="1">I Semestre</option>
                                    <option value="2">II Semestre</option>
                                    <option value="annuale">Annuale (Entrambi i Semestri)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="pagine">Pagine Totali <span class="required">*</span></label>
                                <input type="number" id="pagine" min="1" required placeholder="Es. 450">
                            </div>
                            <div class="form-group">
                                <label for="pagineStudiate">Pagine gi√† Studiate</label>
                                <input type="number" id="pagineStudiate" min="0" value="0" placeholder="Es. 120">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="pagineOra">Pagine per Ora</label>
                                <input type="number" id="pagineOra" min="1" max="50" value="8" placeholder="Es. 8">
                            </div>
                            <div class="form-group">
                                <label for="dataEsame">Data Esame</label>
                                <input type="date" id="dataEsame">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="priorita">Priorit√†</label>
                                <select id="priorita">
                                    <option value="alta">Alta</option>
                                    <option value="media" selected>Media</option>
                                    <option value="bassa">Bassa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Difficolt√† Percepita</label>
                                <div class="star-rating" id="difficolta">
                                    <span class="star" data-rating="1">‚òÖ</span>
                                    <span class="star" data-rating="2">‚òÖ</span>
                                    <span class="star" data-rating="3">‚òÖ</span>
                                    <span class="star" data-rating="4">‚òÖ</span>
                                    <span class="star" data-rating="5">‚òÖ</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>‚è∞ Slot Temporali Settimanali</label>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                Definisci gli slot orari in cui puoi studiare questa materia
                            </p>
                            <div id="weeklySlots" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;"></div>
                        </div>

                        <button type="submit" class="btn btn-primary">‚úÖ Aggiungi Materia</button>
                    </form>
                </div>

                <div class="card fade-in-up">
                    <h3>üìö Le Tue Materie</h3>
                    <div id="materieList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìö</div>
                            <p>Nessuna materia aggiunta ancora.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sezione Curriculum -->
            <section id="curriculum" class="section">
                <div class="flex gap-2 mb-2" style="align-items: center; flex-wrap: wrap;">
                    <div style="background: var(--bg-tertiary); border-radius: var(--border-radius); padding: 4px; border: 1px solid var(--border);">
                        <button class="nav-tab active" data-year="1">1¬∞ Anno</button>
                        <button class="nav-tab" data-year="2">2¬∞ Anno</button>
                        <button class="nav-tab" data-year="3">3¬∞ Anno</button>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="App.UI.showAddSubjectModal()">‚ûï Aggiungi</button>
                    <button class="btn btn-secondary btn-small" onclick="App.CurriculumManager.export()">üì§ Esporta</button>
                </div>

                <div id="curriculumContainer">
                    <!-- Year contents will be dynamically loaded -->
                </div>
            </section>

            <!-- Sezione Esami -->
            <section id="esami" class="section">
                <div class="card fade-in-up">
                    <h3>üìä Statistiche Esami</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--success);" id="totalExams">0</div>
                            <div class="stat-label">Esami Sostenuti</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--warning);" id="totalCFU">0</div>
                            <div class="stat-label">CFU Acquisiti</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--primary);" id="weightedAverage">0.00</div>
                            <div class="stat-label">Media Ponderata</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--secondary);" id="projectedGrade">0</div>
                            <div class="stat-label">Voto Laurea Est.</div>
                        </div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <h3>üéì Esami Sostenuti</h3>
                    <div id="examsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéì</div>
                            <p>Nessun esame sostenuto ancora.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sezione Piano -->
            <section id="piano" class="section">
                <div class="card fade-in-up" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white;">
                    <h4>üéØ Piano di Studio Intelligente</h4>
                    <p id="planSummary">Caricamento piano personalizzato...</p>
                    
                    <div class="stats-grid mt-2">
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: var(--border-radius); text-align: center;">
                            <div id="totalWeeklyHours" style="font-size: 1.8rem; font-weight: 800; margin-bottom: 0.25rem;">0h</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Ore Settimanali</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: var(--border-radius); text-align: center;">
                            <div id="avgDailyHours" style="font-size: 1.8rem; font-weight: 800; margin-bottom: 0.25rem;">0h</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Media Giornaliera</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: var(--border-radius); text-align: center;">
                            <div id="totalPages" style="font-size: 1.8rem; font-weight: 800; margin-bottom: 0.25rem;">0</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Pagine Rimanenti</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: var(--border-radius); text-align: center;">
                            <div id="completionWeeks" style="font-size: 1.8rem; font-weight: 800; margin-bottom: 0.25rem;">0</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Settimane Stimate</div>
                        </div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <h3>üìã Dettagli Piano</h3>
                    <div id="pianDetails">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <p>Aggiungi delle materie per generare il tuo piano personalizzato!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sezione Pomodoro -->
            <section id="pomodoro" class="section">
                <div class="card fade-in-up">
                    <div style="text-align: center;">
                        <h3>üçÖ Timer Pomodoro</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin: 2rem 0;">
                            <button class="btn btn-secondary active" onclick="App.TimerManager.setPreset(25, 5, this)">25/5 min</button>
                            <button class="btn btn-secondary" onclick="App.TimerManager.setPreset(50, 10, this)">50/10 min</button>
                            <button class="btn btn-secondary" onclick="App.TimerManager.setPreset(90, 20, this)">90/20 min</button>
                            <button class="btn btn-secondary" onclick="App.UI.showCustomTimerDialog()">Personalizza</button>
                        </div>

                        <div class="timer-display" id="timerDisplay">25:00</div>

                        <div class="flex gap-2" style="justify-content: center; margin-bottom: 3rem; flex-wrap: wrap;">
                            <button class="btn btn-primary" id="startBtn" onclick="App.TimerManager.start()">‚ñ∂Ô∏è Inizia</button>
                            <button class="btn btn-warning hidden" id="pauseBtn" onclick="App.TimerManager.pause()">‚è∏Ô∏è Pausa</button>
                            <button class="btn btn-danger" onclick="App.TimerManager.reset()">üîÑ Reset</button>
                        </div>

                        <div>
                            <p><strong>Sessioni completate oggi:</strong> <span id="sessionCount">0</span> / <span id="sessionGoal">8</span></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="sessionProgress" style="width: 0%"></div>
                            </div>
                            <small id="progressText" style="color: var(--text-secondary);">Inizia la tua prima sessione!</small>
                        </div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <div class="flex-between mb-2 flex-wrap">
                        <h3 style="margin: 0;">üìä Tutte le Sessioni di Oggi</h3>
                        <button class="btn btn-danger btn-small" onclick="App.SessionManager.deleteAllToday()">üóëÔ∏è Elimina tutte</button>
                    </div>
                    
                    <div id="allTodaySessionsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üçÖ</div>
                            <p>Nessuna sessione completata oggi.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sezione Calendario -->
            <section id="calendario" class="section">
                <div class="card fade-in-up">
                    <h3>üìÖ Navigazione Calendario</h3>
                    <div class="flex-between flex-wrap">
                        <div class="flex gap-2" style="align-items: center;">
                            <button class="btn btn-secondary btn-small" onclick="App.CalendarManager.changeMonth(-1)">‚óÄ Prec</button>
                            <h4 id="currentMonthYear" style="margin: 0; min-width: 200px; text-align: center;">Gennaio 2024</h4>
                            <button class="btn btn-secondary btn-small" onclick="App.CalendarManager.changeMonth(1)">Succ ‚ñ∂</button>
                        </div>
                        <div class="flex gap-2">
                            <button class="btn btn-primary btn-small" onclick="App.CalendarManager.goToToday()">üìç Oggi</button>
                            <button class="btn btn-warning btn-small" onclick="App.CalendarManager.addManualSession()">‚ûï Sessione</button>
                        </div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <div style="background: var(--bg-card); border-radius: var(--border-radius-lg); overflow: hidden; box-shadow: var(--shadow-lg); border: 1px solid var(--border);">
                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); background: var(--bg-tertiary); border-bottom: 1px solid var(--border);">
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Lun</div>
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Mar</div>
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Mer</div>
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Gio</div>
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Ven</div>
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Sab</div>
                            <div style="padding: 1rem 0.5rem; text-align: center; font-weight: 600; color: var(--primary-light);">Dom</div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <h3>üìä Statistiche del Mese</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--primary-light);" id="monthSessions">0</div>
                            <div class="stat-label">Sessioni Totali</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--secondary);" id="monthHours">0h</div>
                            <div class="stat-label">Ore di Studio</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--warning);" id="monthDays">0</div>
                            <div class="stat-label">Giorni Attivi</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--accent);" id="monthAverage">0</div>
                            <div class="stat-label">Media/Giorno</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sezione Statistiche -->
            <section id="statistiche" class="section">
                <div class="card fade-in-up">
                    <h3>üìä Statistiche e Progressi</h3>
                    <div id="statisticheContent">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <p>Aggiungi delle materie per vedere i tuoi progressi!</p>
                        </div>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <h3>üî• Heatmap Oraria della Produttivit√†</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Visualizza i tuoi momenti pi√π produttivi durante la giornata
                    </p>
                    <div class="heatmap-grid" id="heatmapGrid"></div>
                </div>
            </section>

            <!-- Sezione Helper -->
            <section id="helper" class="section">
                <div class="card fade-in-up" style="background: linear-gradient(135deg, var(--accent), #d97706); color: white;">
                    <h3>üéØ Assistente Organizzazione Semestre</h3>
                    <p style="margin-bottom: 1.5rem; opacity: 0.9;">Non sai come organizzarti? Lascia che ti guidi nella pianificazione!</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                        <button onclick="App.HelperManager.prioritizeByDate()" style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: var(--border-radius); cursor: pointer; transition: all var(--transition); border: 2px solid transparent; border: none; color: white;">
                            <h4 style="margin-bottom: 0.5rem;">üìÖ Priorit√† per Scadenze</h4>
                            <p style="opacity: 0.9;">Ordina le materie in base alle date degli esami</p>
                        </button>
                        
                        <button onclick="App.HelperManager.prioritizeByDifficulty()" style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: var(--border-radius); cursor: pointer; transition: all var(--transition); border: 2px solid transparent; border: none; color: white;">
                            <h4 style="margin-bottom: 0.5rem;">‚≠ê Priorit√† per Difficolt√†</h4>
                            <p style="opacity: 0.9;">Inizia dalle materie pi√π difficili</p>
                        </button>
                        
                        <button onclick="App.HelperManager.balancedApproach()" style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: var(--border-radius); cursor: pointer; transition: all var(--transition); border: 2px solid transparent; border: none; color: white;">
                            <h4 style="margin-bottom: 0.5rem;">‚öñÔ∏è Approccio Bilanciato</h4>
                            <p style="opacity: 0.9;">Mix intelligente tra scadenze e difficolt√†</p>
                        </button>
                    </div>
                </div>

                <div class="card hidden fade-in-up" id="helperResults">
                    <h3>üìã Piano Raccomandato</h3>
                    <div id="helperContent"></div>
                </div>
            </section>

            <!-- Sezione Impostazioni -->
            <section id="impostazioni" class="section">
                <div class="card fade-in-up" style="background: linear-gradient(135deg, var(--danger), #dc2626); color: white; text-align: center;">
                    <h3>‚öôÔ∏è Impostazioni App</h3>
                    <p style="margin-bottom: 1.5rem;">Gestisci i dati dell'applicazione e le configurazioni</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
                        <button onclick="App.DataManager.exportAll()" style="background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); color: white; padding: 1rem 2rem; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: all var(--transition);">
                            üì§ Esporta Dati
                        </button>
                        <button onclick="App.DataManager.importAll()" style="background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); color: white; padding: 1rem 2rem; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: all var(--transition);">
                            üì• Importa Dati
                        </button>
                        <button onclick="App.DataManager.showResetConfirmation()" style="background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); color: white; padding: 1rem 2rem; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: all var(--transition);">
                            üóëÔ∏è Reset Completo
                        </button>
                    </div>
                </div>

                <div class="card fade-in-up">
                    <h3>üîß Preferenze App</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="autoBackup">üíæ Backup Automatico</label>
                            <select id="autoBackup" onchange="App.SettingsManager.updateAutoBackup()">
                                <option value="disabled">Disabilitato</option>
                                <option value="daily" selected>Giornaliero</option>
                                <option value="weekly">Settimanale</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="examNotifications">üîî Notifiche Esami</label>
                            <select id="examNotifications" onchange="App.SettingsManager.updateExamNotifications()">
                                <option value="disabled">Disabilitate</option>
                                <option value="7days" selected>7 giorni prima</option>
                                <option value="3days">3 giorni prima</option>
                                <option value="1day">1 giorno prima</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="ratingModal">
        <div class="modal">
            <h3>üéâ Sessione Completata!</h3>
            <div id="sessionRatingContent">
                <!-- Rating content will be dynamically loaded -->
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="customTimerModal">
        <div class="modal">
            <h3>‚öôÔ∏è Timer Personalizzato</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="customWorkTime">Minuti di Studio:</label>
                    <input type="number" id="customWorkTime" min="1" max="180" value="25" placeholder="25">
                </div>
                <div class="form-group">
                    <label for="customBreakTime">Minuti di Pausa:</label>
                    <input type="number" id="customBreakTime" min="0" max="60" value="5" placeholder="5">
                </div>
            </div>
            <div class="flex gap-2 mt-2">
                <button class="btn btn-primary" onclick="App.TimerManager.applyCustom()">‚úÖ Applica</button>
                <button class="btn btn-secondary" onclick="App.UI.closeModal('customTimerModal')">‚ùå Annulla</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="dayDetailModal">
        <div class="modal modal-large">
            <h3 id="dayDetailTitle">üìÖ Dettagli del Giorno</h3>
            <div class="mb-2">
                <button class="btn btn-primary btn-small" onclick="App.CalendarManager.addSessionToDay()">‚ûï Aggiungi Sessione</button>
            </div>
            <div id="daySessionsList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <p>Nessuna sessione per questo giorno.</p>
                </div>
            </div>
            <div class="mt-2">
                <button class="btn btn-secondary" onclick="App.UI.closeModal('dayDetailModal')">‚ùå Chiudi</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addSubjectModal">
        <div class="modal">
            <h3>‚ûï Aggiungi Materia al Curriculum</h3>
            <form id="currSubjectForm" onsubmit="event.preventDefault(); App.CurriculumManager.saveSubject();">
                <div class="form-group">
                    <label for="currSubjectName">Nome Materia <span class="required">*</span></label>
                    <input type="text" id="currSubjectName" required placeholder="Es. Analisi Matematica I">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="currSubjectYear">Anno <span class="required">*</span></label>
                        <select id="currSubjectYear" required>
                            <option value="1">1¬∞ Anno</option>
                            <option value="2">2¬∞ Anno</option>
                            <option value="3">3¬∞ Anno</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="currSubjectSemester">Semestre <span class="required">*</span></label>
                        <select id="currSubjectSemester" required>
                            <option value="1">I Semestre</option>
                            <option value="2">II Semestre</option>
                            <option value="annuale">Annuale (Entrambi)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="currSubjectCFU">CFU <span class="required">*</span></label>
                    <input type="number" id="currSubjectCFU" min="1" max="30" required placeholder="Es. 9">
                </div>
                <div class="flex gap-2 mt-2">
                    <button type="submit" class="btn btn-primary">‚úÖ Aggiungi</button>
                    <button type="button" class="btn btn-secondary" onclick="App.UI.closeModal('addSubjectModal')">‚ùå Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="examModal">
        <div class="modal">
            <h3>üéì Registra Esame Sostenuto</h3>
            <form id="examForm" onsubmit="event.preventDefault(); App.ExamManager.saveGrade();">
                <div class="form-group">
                    <label for="examSubject">Materia:</label>
                    <input type="text" id="examSubject" readonly style="background: var(--bg-secondary);">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="examGrade">Voto (18-30):</label>
                        <input type="number" id="examGrade" min="18" max="30" placeholder="30" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="examLode"> Lode
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="examDate">Data Esame:</label>
                    <input type="date" id="examDate">
                </div>
                <div class="flex gap-2 mt-2">
                    <button type="submit" class="btn btn-success">‚úÖ Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="App.UI.closeModal('examModal')">‚ùå Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="addSessionModal">
        <div class="modal">
            <h3>‚ûï Aggiungi Sessione Studio</h3>
            <form id="sessionForm" onsubmit="event.preventDefault(); App.CalendarManager.saveManualSession();">
                <div class="form-group">
                    <label for="sessionDate">Data:</label>
                    <input type="date" id="sessionDate" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="sessionMateria">Materia:</label>
                        <select id="sessionMateria">
                            <option value="">Sessione generica</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sessionDuration">Durata (minuti):</label>
                        <input type="number" id="sessionDuration" min="5" max="300" value="25" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="sessionNote">Note (opzionale):</label>
                    <input type="text" id="sessionNote" placeholder="Es. Capitolo 3 - Derivate">
                </div>
                <div class="flex gap-2 mt-2">
                    <button type="submit" class="btn btn-primary">‚úÖ Aggiungi</button>
                    <button type="button" class="btn btn-secondary" onclick="App.UI.closeModal('addSessionModal')">‚ùå Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="resetConfirmationModal">
        <div class="modal">
            <h3>‚ö†Ô∏è Conferma Reset Completo</h3>
            <div style="text-align: center; margin: 2rem 0;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üóëÔ∏è</div>
                <p style="margin-bottom: 1rem;"><strong>ATTENZIONE:</strong> Eliminerai TUTTI i dati dell'app!</p>
                <p style="color: var(--danger); font-weight: 600;">Questa azione NON pu√≤ essere annullata!</p>
            </div>
            <div class="form-group">
                <label for="resetConfirmText">Scrivi "RESET" per confermare:</label>
                <input type="text" id="resetConfirmText" placeholder="RESET" style="text-align: center; text-transform: uppercase;">
            </div>
            <div class="flex gap-2 mt-2">
                <button class="btn btn-danger" onclick="App.DataManager.performReset()">üóëÔ∏è Reset</button>
                <button class="btn btn-secondary" onclick="App.UI.closeModal('resetConfirmationModal')">‚ùå Annulla</button>
            </div>
        </div>
    </div>

    <div class="tooltip" id="heatmapTooltip"></div>

    <script>
        // === APP NAMESPACE ===
        const App = {
            // State management
            State: {
                materie: [],
                esami: [],
                curriculum: [],
                calendarSessions: {},
                sessionRatings: {},
                timerState: {
                    minutes: 25,
                    seconds: 0,
                    isRunning: false,
                    isBreak: false,
                    workTime: 25,
                    breakTime: 5,
                    sessionsToday: 0,
                    lastSessionDate: '',
                    dailyGoal: 8
                },
                studyData: {
                    streak: 0,
                    lastStudyDate: '',
                    totalSessions: 0,
                    missedTime: 0
                },
                currentCalendarDate: new Date(),
                difficoltaSelezionata: 3,
                timerInterval: null,
                selectedTaskOption: null,
                currentSessionData: null,
                currentEditingExamId: null,
                currentCurriculumYear: 1,
                currentDayDetailDate: null,
                mobileNavOpen: false,
                currentFilter: 'all',
                autoBackupEnabled: true,
                sessionType: null,
                progressType: null,
                helperCurrentStrategy: null,
                todayDetailedSessions: []
            },

            // Initialize the app
            init() {
                this.loadFromStorage();
                this.setupEventListeners();
                this.initializeComponents();
                this.checkDailyReset();
                this.NotificationManager.checkUpcomingExams();
                
                // Setup auto-save
                setInterval(() => this.saveToStorage(), 30000); // Auto-save every 30 seconds
                
                // Setup periodic checks
                setInterval(() => this.NotificationManager.checkUpcomingExams(), 3600000); // Every hour
                setInterval(() => this.BackupManager.performAutoBackup(), 21600000); // Every 6 hours
                
                console.log('üìö Piano Studio Smart v3.0 inizializzato con successo!');
            },

            // Load data from localStorage
            loadFromStorage() {
                try {
                    this.State.materie = JSON.parse(localStorage.getItem('materie')) || [];
                    this.State.esami = JSON.parse(localStorage.getItem('esami')) || [];
                    this.State.curriculum = JSON.parse(localStorage.getItem('curriculum')) || [];
                    this.State.calendarSessions = JSON.parse(localStorage.getItem('calendarSessions')) || {};
                    this.State.sessionRatings = JSON.parse(localStorage.getItem('sessionRatings')) || {};
                    this.State.todayDetailedSessions = JSON.parse(localStorage.getItem('todayDetailedSessions')) || [];
                    
                    // Timer state
                    this.State.timerState.sessionsToday = parseInt(localStorage.getItem('sessionsToday')) || 0;
                    this.State.timerState.lastSessionDate = localStorage.getItem('lastSessionDate') || '';
                    this.State.timerState.dailyGoal = parseInt(localStorage.getItem('dailyGoal')) || 8;
                    
                    // Study data
                    this.State.studyData.streak = parseInt(localStorage.getItem('studyStreak')) || 0;
                    this.State.studyData.lastStudyDate = localStorage.getItem('lastStudyDate') || '';
                    this.State.studyData.totalSessions = parseInt(localStorage.getItem('totalSessions')) || 0;
                    this.State.studyData.missedTime = parseInt(localStorage.getItem('missedTime')) || 0;
                    
                    // Settings
                    this.State.autoBackupEnabled = localStorage.getItem('autoBackup') !== 'disabled';
                } catch (error) {
                    console.error('Errore nel caricamento dei dati:', error);
                    this.Utils.showMessage('Errore nel caricamento dei dati', 'error');
                }
            },

            // Save data to localStorage
            saveToStorage() {
                try {
                    localStorage.setItem('materie', JSON.stringify(this.State.materie));
                    localStorage.setItem('esami', JSON.stringify(this.State.esami));
                    localStorage.setItem('curriculum', JSON.stringify(this.State.curriculum));
                    localStorage.setItem('calendarSessions', JSON.stringify(this.State.calendarSessions));
                    localStorage.setItem('sessionRatings', JSON.stringify(this.State.sessionRatings));
                    localStorage.setItem('todayDetailedSessions', JSON.stringify(this.State.todayDetailedSessions));
                    localStorage.setItem('sessionsToday', this.State.timerState.sessionsToday);
                    localStorage.setItem('lastSessionDate', this.State.timerState.lastSessionDate);
                    localStorage.setItem('dailyGoal', this.State.timerState.dailyGoal);
                    localStorage.setItem('studyStreak', this.State.studyData.streak);
                    localStorage.setItem('lastStudyDate', this.State.studyData.lastStudyDate);
                    localStorage.setItem('totalSessions', this.State.studyData.totalSessions);
                    localStorage.setItem('missedTime', this.State.studyData.missedTime);
                } catch (error) {
                    console.error('Errore nel salvataggio dei dati:', error);
                }
            },

            // Setup event listeners
            setupEventListeners() {
                // Navigation tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const section = e.target.dataset.section || e.target.dataset.year;
                        if (e.target.dataset.section) {
                            this.Navigation.showSection(section, e.target);
                        } else if (e.target.dataset.year) {
                            this.CurriculumManager.showYear(parseInt(section), e.target);
                        }
                    });
                });

                // Filter chips
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.addEventListener('click', (e) => {
                        const filter = e.target.dataset.filter;
                        this.UI.toggleFilter(filter, e.target);
                    });
                });

                // Star rating
                document.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('click', (e) => {
                        this.State.difficoltaSelezionata = parseInt(e.target.dataset.rating);
                        this.StarRating.update();
                    });
                });

                // Modal close on overlay click
                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            overlay.style.display = 'none';
                        }
                    });
                });

                // Prevent modal close on content click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
                });

                // Close mobile nav on outside click
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.nav-container') && this.State.mobileNavOpen) {
                        this.Navigation.closeMobile();
                    }
                });
            },

            // Initialize components
            initializeComponents() {
                this.MaterieManager.load();
                this.TimerManager.updateDisplay();
                this.TimerManager.updateSessionDisplay();
                this.SmartPlanner.generateTodaySchedule();
                this.WeeklySlots.initialize();
                this.StarRating.setup();
                this.SessionManager.updateTodayList();
                this.CalendarManager.render();
                this.HeatmapManager.update();
                this.StatisticsManager.update();
                this.ExamManager.updateSection();
                this.CurriculumManager.load();
                this.PlanManager.generate();
                
                // Load settings
                document.getElementById('autoBackup').value = localStorage.getItem('autoBackup') || 'daily';
                document.getElementById('examNotifications').value = localStorage.getItem('examNotifications') || '7days';
            },

            // Check for daily reset
            checkDailyReset() {
                const today = new Date().toDateString();
                if (this.State.timerState.lastSessionDate !== today) {
                    this.State.timerState.sessionsToday = 0;
                    this.State.todayDetailedSessions = [];
                    this.saveToStorage();
                }
            }
        };

        // === UTILITIES ===
        App.Utils = {
            showMessage(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.4s ease';
                    setTimeout(() => document.body.removeChild(toast), 400);
                }, 4000);
            },

            calculateTaskDuration(inizio, fine) {
                const [startH, startM] = inizio.split(':').map(Number);
                const [endH, endM] = fine.split(':').map(Number);
                return (endH * 60 + endM) - (startH * 60 + startM);
            },

            getDaysToExam(dataEsame) {
                if (!dataEsame) return null;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const examDate = new Date(dataEsame);
                examDate.setHours(0, 0, 0, 0);
                const diffTime = examDate - today;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            },

            formatTime(minutes) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return hours > 0 ? `${hours}h ${mins}min` : `${mins}min`;
            },

            calculateSmartPriority(materia) {
                let score = 0;
                const daysToExam = this.getDaysToExam(materia.dataEsame);
                
                // Exam proximity score
                if (daysToExam !== null) {
                    if (daysToExam <= 3) score += 50;
                    else if (daysToExam <= 7) score += 45;
                    else if (daysToExam <= 14) score += 35;
                    else if (daysToExam <= 30) score += 25;
                    else if (daysToExam <= 60) score += 15;
                    else score += 5;
                }
                
                // Priority score
                const priorityMap = { 'alta': 25, 'media': 15, 'bassa': 5 };
                score += priorityMap[materia.priorita] || 15;
                
                // Difficulty score
                score += (materia.difficolta || 3) * 4;
                
                // CFU score
                score += Math.min(materia.cfu * 1.5, 15);
                
                // Progress score
                const progress = ((materia.pagineStudiate || 0) / materia.pagine) * 100;
                if (progress < 10) score += 12;
                else if (progress < 30) score += 8;
                else if (progress > 80) score += 10;
                else score += 5;
                
                return Math.round(score);
            },

            formatDateForInput(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },

            parseDateFromInput(dateString) {
                const [year, month, day] = dateString.split('-').map(Number);
                return new Date(year, month - 1, day);
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            validateForm(formId) {
                const form = document.getElementById(formId);
                if (!form) return false;
                return form.checkValidity();
            }
        };

        // === NAVIGATION MANAGER ===
        App.Navigation = {
            showSection(sectionName, targetElement) {
                this.closeMobile();
                
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Remove active class from all tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show target section
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // Set active tab
                if (targetElement) {
                    targetElement.classList.add('active');
                }
                
                // Load section-specific content
                this.loadSectionContent(sectionName);
            },

            loadSectionContent(sectionName) {
                const contentLoaders = {
                    'oggi': () => App.SmartPlanner.generateTodaySchedule(),
                    'materie': () => {
                        App.MaterieManager.load();
                        App.WeeklySlots.initialize();
                        App.StarRating.setup();
                    },
                    'curriculum': () => App.CurriculumManager.load(),
                    'esami': () => App.ExamManager.updateSection(),
                    'piano': () => App.PlanManager.generate(),
                    'pomodoro': () => App.SessionManager.updateTodayList(),
                    'calendario': () => App.CalendarManager.render(),
                    'statistiche': () => {
                        App.StatisticsManager.update();
                        App.HeatmapManager.update();
                    },
                    'helper': () => {},
                    'impostazioni': () => {}
                };

                const loader = contentLoaders[sectionName];
                if (loader) {
                    setTimeout(loader, 100);
                }
            },

            toggleMobile() {
                const dropdown = document.getElementById('navDropdown');
                App.State.mobileNavOpen = !App.State.mobileNavOpen;
                
                if (App.State.mobileNavOpen) {
                    dropdown.classList.add('show');
                    this.populateMobileNav();
                } else {
                    dropdown.classList.remove('show');
                }
            },

            populateMobileNav() {
                const dropdown = document.getElementById('navDropdown');
                const tabs = document.querySelectorAll('#navTabs .nav-tab');
                
                dropdown.innerHTML = '';
                tabs.forEach(tab => {
                    const mobileTab = tab.cloneNode(true);
                    mobileTab.addEventListener('click', () => {
                        const section = tab.dataset.section;
                        if (section) {
                            this.showSection(section, tab);
                            this.closeMobile();
                        }
                    });
                    dropdown.appendChild(mobileTab);
                });
            },

            closeMobile() {
                const dropdown = document.getElementById('navDropdown');
                dropdown.classList.remove('show');
                App.State.mobileNavOpen = false;
            }
        };

        // === MATERIE MANAGER ===
        App.MaterieManager = {
            add() {
                if (!App.Utils.validateForm('materiaForm')) {
                    App.Utils.showMessage('Compila tutti i campi obbligatori', 'error');
                    return;
                }

                const formData = this.getFormData();
                
                if (formData.pagineStudiate > formData.pagine) {
                    App.Utils.showMessage('Le pagine studiate non possono essere superiori al totale', 'error');
                    return;
                }

                const nuovaMateria = {
                    id: Date.now(),
                    ...formData,
                    difficolta: App.State.difficoltaSelezionata,
                    slotSettimanali: App.WeeklySlots.get(),
                    status: 'studio',
                    dataCreazione: new Date().toISOString()
                };

                App.State.materie.push(nuovaMateria);
                App.saveToStorage();
                
                this.load();
                this.resetForm();
                App.SmartPlanner.generateTodaySchedule();
                App.PlanManager.generate();
                
                App.Utils.showMessage('‚úÖ Materia aggiunta con successo!');
            },

            getFormData() {
                return {
                    nome: document.getElementById('nomeMateria').value.trim(),
                    cfu: parseInt(document.getElementById('cfu').value),
                    anno: parseInt(document.getElementById('anno').value),
                    semestre: document.getElementById('semestre').value,
                    pagine: parseInt(document.getElementById('pagine').value),
                    pagineStudiate: parseInt(document.getElementById('pagineStudiate').value) || 0,
                    pagineOra: parseInt(document.getElementById('pagineOra').value) || 8,
                    dataEsame: document.getElementById('dataEsame').value,
                    priorita: document.getElementById('priorita').value
                };
            },

            resetForm() {
                document.getElementById('materiaForm').reset();
                document.getElementById('pagineStudiate').value = '0';
                document.getElementById('pagineOra').value = '8';
                document.getElementById('priorita').value = 'media';
                App.State.difficoltaSelezionata = 3;
                App.WeeklySlots.initialize();
                App.StarRating.setup();
            },

            load() {
                const container = document.getElementById('materieList');
                
                if (App.State.materie.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìö</div>
                            <p>Nessuna materia aggiunta ancora.</p>
                        </div>
                    `;
                    return;
                }

                const filteredMaterie = this.getFilteredMaterie();
                
                container.innerHTML = filteredMaterie.map(materia => 
                    this.renderMateriaCard(materia)
                ).join('');
            },

            getFilteredMaterie() {
                const searchTerm = document.getElementById('searchMateria')?.value.toLowerCase() || '';
                
                return App.State.materie.filter(materia => {
                    const matchesSearch = materia.nome.toLowerCase().includes(searchTerm);
                    const matchesFilter = App.State.currentFilter === 'all' || 
                        (App.State.currentFilter === 'studio' && materia.status !== 'completato') ||
                        (App.State.currentFilter === 'completato' && materia.status === 'completato');
                    
                    return matchesSearch && matchesFilter;
                });
            },

            renderMateriaCard(materia) {
                const percentualeCompletamento = Math.round(((materia.pagineStudiate || 0) / materia.pagine) * 100);
                const isExamCompleted = materia.status === 'completato';
                const examData = App.State.esami.find(e => e.materiaId === materia.id);
                const smartPriority = App.Utils.calculateSmartPriority(materia);
                
                return `
                    <div class="subject-item ${isExamCompleted ? 'exam-completed' : ''} fade-in-up">
                        <div class="flex-between mb-2 flex-wrap">
                            <div style="font-size: 1.3rem; font-weight: 700; color: var(--primary-light);">${materia.nome}</div>
                            <div class="flex gap-1 flex-wrap">
                                <span style="padding: 8px 16px; border-radius: 25px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; ${isExamCompleted ? 'background: rgba(16, 185, 129, 0.2); color: var(--success);' : 'background: rgba(139, 92, 246, 0.2); color: var(--primary-light);'}">
                                    ${isExamCompleted ? 'üéì Completato' : 'üìö In Studio'}
                                </span>
                                ${!isExamCompleted ? `
                                    <button class="btn btn-success btn-small" onclick="App.MaterieManager.markAsExamCompleted(${materia.id})">üéì</button>
                                ` : ''}
                                <button class="btn btn-warning btn-small" onclick="App.MaterieManager.edit(${materia.id})">‚úèÔ∏è</button>
                                <button class="btn btn-danger btn-small" onclick="App.MaterieManager.delete(${materia.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        ${!isExamCompleted ? `
                            <div class="mb-2">
                                <div class="flex-between mb-1">
                                    <strong>Progresso Studio:</strong>
                                    <span style="color: var(--secondary); font-weight: 600;">${percentualeCompletamento}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentualeCompletamento}%"></div>
                                </div>
                                <small style="color: var(--text-secondary);">${materia.pagineStudiate || 0}/${materia.pagine} pagine completate</small>
                            </div>
                        ` : examData ? `
                            <div class="flex gap-2 mb-2 flex-wrap">
                                <div style="font-size: 2rem; font-weight: 800; color: var(--success);">${examData.voto}${examData.lode ? 'L' : ''}</div>
                                <div>
                                    <div style="color: var(--success); font-weight: 600;">Esame sostenuto</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                        ${examData.dataEsame ? new Date(examData.dataEsame).toLocaleDateString('it-IT') : ''}
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">
                            <div><strong>Anno:</strong> ${materia.anno}¬∞</div>
                            <div><strong>Semestre:</strong> ${materia.semestre}</div>
                            <div><strong>CFU:</strong> ${materia.cfu}</div>
                            <div><strong>Priorit√†:</strong> ${materia.priorita}</div>
                            ${!isExamCompleted ? `<div><strong>Score:</strong> ${smartPriority}</div>` : ''}
                        </div>
                    </div>
                `;
            },

            filter() {
                this.load();
            },

            markAsExamCompleted(materiaId) {
                const materia = App.State.materie.find(m => m.id === materiaId);
                if (!materia) return;

                document.getElementById('examSubject').value = materia.nome;
                document.getElementById('examModal').dataset.materiaId = materiaId;
                document.getElementById('examModal').style.display = 'flex';
            },

            edit(id) {
                const materia = App.State.materie.find(m => m.id === id);
                if (!materia) return;

                // Populate form with materia data
                document.getElementById('nomeMateria').value = materia.nome;
                document.getElementById('cfu').value = materia.cfu;
                document.getElementById('anno').value = materia.anno;
                document.getElementById('semestre').value = materia.semestre;
                document.getElementById('pagine').value = materia.pagine;
                document.getElementById('pagineStudiate').value = materia.pagineStudiate || 0;
                document.getElementById('pagineOra').value = materia.pagineOra || 8;
                document.getElementById('dataEsame').value = materia.dataEsame || '';
                document.getElementById('priorita').value = materia.priorita;
                
                App.State.difficoltaSelezionata = materia.difficolta || 3;
                App.StarRating.update();

                // Remove materia for re-adding
                App.State.materie = App.State.materie.filter(m => m.id !== id);
                App.saveToStorage();
                this.load();

                // Navigate to materie section
                App.Navigation.showSection('materie', document.querySelector('[data-section="materie"]'));
                App.Utils.showMessage('üìù Materia caricata per modifica');
            },

            delete(id) {
                const materia = App.State.materie.find(m => m.id === id);
                if (!materia) return;

                if (confirm(`Sei sicuro di voler eliminare "${materia.nome}"?`)) {
                    App.State.materie = App.State.materie.filter(m => m.id !== id);
                    App.State.esami = App.State.esami.filter(e => e.materiaId !== id);
                    App.saveToStorage();
                    
                    this.load();
                    App.ExamManager.updateSection();
                    App.SmartPlanner.generateTodaySchedule();
                    App.PlanManager.generate();
                    
                    App.Utils.showMessage('üóëÔ∏è Materia eliminata con successo');
                }
            }
        };

        // === TIMER MANAGER ===
        App.TimerManager = {
            updateDisplay() {
                const display = `${App.State.timerState.minutes.toString().padStart(2, '0')}:${App.State.timerState.seconds.toString().padStart(2, '0')}`;
                const timerEl = document.getElementById('timerDisplay');
                
                if (timerEl) {
                    timerEl.textContent = display;
                    timerEl.classList.toggle('break-mode', App.State.timerState.isBreak);
                }
                
                // Update document title
                if (App.State.timerState.isRunning) {
                    document.title = `${display} - Piano Studio Smart`;
                } else {
                    document.title = 'Piano Studio Smart - AI Enhanced Pro v3.0';
                }
            },

            updateSessionDisplay() {
                const elements = {
                    sessionCount: document.getElementById('sessionCount'),
                    sessionGoal: document.getElementById('sessionGoal'),
                    sessionProgress: document.getElementById('sessionProgress'),
                    progressText: document.getElementById('progressText'),
                    streakNumber: document.getElementById('streakNumber')
                };

                if (elements.sessionCount) {
                    elements.sessionCount.textContent = App.State.timerState.sessionsToday;
                }
                
                if (elements.sessionGoal) {
                    elements.sessionGoal.textContent = App.State.timerState.dailyGoal;
                }
                
                if (elements.sessionProgress) {
                    const progress = Math.min(100, (App.State.timerState.sessionsToday / App.State.timerState.dailyGoal) * 100);
                    elements.sessionProgress.style.width = progress + '%';
                }
                
                if (elements.progressText) {
                    if (App.State.timerState.sessionsToday === 0) {
                        elements.progressText.textContent = 'Inizia la tua prima sessione!';
                    } else if (App.State.timerState.sessionsToday >= App.State.timerState.dailyGoal) {
                        elements.progressText.textContent = 'üéâ Obiettivo raggiunto! Ottimo lavoro!';
                    } else {
                        const remaining = App.State.timerState.dailyGoal - App.State.timerState.sessionsToday;
                        elements.progressText.textContent = `Ancora ${remaining} sessioni per raggiungere l'obiettivo`;
                    }
                }
                
                if (elements.streakNumber) {
                    elements.streakNumber.textContent = App.State.studyData.streak;
                }
            },

            setPreset(work, breakTime, targetElement) {
                if (App.State.timerState.isRunning) return;
                
                App.State.timerState.workTime = work;
                App.State.timerState.breakTime = breakTime;
                App.State.timerState.minutes = work;
                App.State.timerState.seconds = 0;
                App.State.timerState.isBreak = false;
                
                this.updateDisplay();
                
                // Update button states
                document.querySelectorAll('.btn-secondary').forEach(btn => {
                    btn.classList.remove('active');
                });
                if (targetElement) {
                    targetElement.classList.add('active');
                }
            },

            start() {
                if (App.State.timerState.isRunning) return;
                
                App.State.timerState.isRunning = true;
                App.State.currentSessionStartTime = new Date();
                
                const startBtn = document.getElementById('startBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                
                if (startBtn) startBtn.classList.add('hidden');
                if (pauseBtn) pauseBtn.classList.remove('hidden');
                
                App.State.timerInterval = setInterval(() => {
                    if (App.State.timerState.seconds === 0) {
                        if (App.State.timerState.minutes === 0) {
                            this.complete();
                            return;
                        } else {
                            App.State.timerState.minutes--;
                            App.State.timerState.seconds = 59;
                        }
                    } else {
                        App.State.timerState.seconds--;
                    }
                    
                    this.updateDisplay();
                }, 1000);
            },

            startTask() {
                if (!App.State.selectedTaskOption) {
                    App.Utils.showMessage('‚ö†Ô∏è Seleziona prima cosa vuoi studiare', 'error');
                    return;
                }
                
                this.start();
                App.Utils.showMessage('üöÄ Sessione di studio iniziata!');
            },

            pause() {
                if (!App.State.timerState.isRunning) return;
                
                App.State.timerState.isRunning = false;
                clearInterval(App.State.timerInterval);
                
                const startBtn = document.getElementById('startBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                
                if (startBtn) startBtn.classList.remove('hidden');
                if (pauseBtn) pauseBtn.classList.add('hidden');
            },

            reset() {
                App.State.timerState.isRunning = false;
                clearInterval(App.State.timerInterval);
                
                App.State.timerState.minutes = App.State.timerState.workTime;
                App.State.timerState.seconds = 0;
                App.State.timerState.isBreak = false;
                
                const startBtn = document.getElementById('startBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                
                if (startBtn) startBtn.classList.remove('hidden');
                if (pauseBtn) pauseBtn.classList.add('hidden');
                
                this.updateDisplay();
            },

            complete() {
                clearInterval(App.State.timerInterval);
                App.State.timerState.isRunning = false;
                
                if (!App.State.timerState.isBreak) {
                    // Work session completed
                    App.State.timerState.sessionsToday++;
                    App.State.studyData.totalSessions++;
                    
                    // Update streak
                    const today = new Date().toDateString();
                    if (App.State.studyData.lastStudyDate !== today) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        
                        if (App.State.studyData.lastStudyDate === yesterday.toDateString()) {
                            App.State.studyData.streak++;
                        } else {
                            App.State.studyData.streak = 1;
                        }
                        App.State.studyData.lastStudyDate = today;
                    }
                    
                    App.State.timerState.lastSessionDate = today;
                    App.saveToStorage();
                    
                    this.updateSessionDisplay();
                    App.SessionTracker.showModal();
                    
                    // Start break if configured
                    if (App.State.timerState.breakTime > 0) {
                        setTimeout(() => {
                            App.State.timerState.isBreak = true;
                            App.State.timerState.minutes = App.State.timerState.breakTime;
                            App.State.timerState.seconds = 0;
                            this.updateDisplay();
                            App.Utils.showMessage('‚è∏Ô∏è Inizia la tua pausa!');
                        }, 2000);
                    }
                } else {
                    // Break completed
                    App.State.timerState.isBreak = false;
                    App.State.timerState.minutes = App.State.timerState.workTime;
                    App.State.timerState.seconds = 0;
                    this.updateDisplay();
                    App.Utils.showMessage('üöÄ Pausa finita! Torna al lavoro!');
                }
                
                this.reset();
            },

            applyCustom() {
                const workTime = parseInt(document.getElementById('customWorkTime').value);
                const breakTime = parseInt(document.getElementById('customBreakTime').value);
                
                if (!workTime || workTime < 1 || workTime > 180) {
                    App.Utils.showMessage('Inserisci un tempo di studio valido (1-180 minuti)', 'error');
                    return;
                }
                
                if (breakTime < 0 || breakTime > 60) {
                    App.Utils.showMessage('Inserisci un tempo di pausa valido (0-60 minuti)', 'error');
                    return;
                }
                
                this.setPreset(workTime, breakTime, null);
                App.UI.closeModal('customTimerModal');
                App.Utils.showMessage(`‚úÖ Timer personalizzato: ${workTime}/${breakTime} minuti`);
            }
        };

        // === SESSION TRACKER ===
        App.SessionTracker = {
            showModal() {
                const modalContent = `
                    <div class="text-center">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üéâ</div>
                        <p style="margin-bottom: 1.5rem;">Come ti senti dopo questa sessione?</p>
                        
                        <div class="form-group">
                            <label for="sessionNote">üìù Note (opzionale):</label>
                            <input type="text" id="sessionNote" placeholder="Es. Ho studiato il capitolo 3...">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 2rem;">
                            <button onclick="App.SessionTracker.submitRating(1)" class="btn btn-secondary">
                                <div style="font-size: 2rem;">üò¥</div>
                                <div>Stanco</div>
                            </button>
                            <button onclick="App.SessionTracker.submitRating(2)" class="btn btn-secondary">
                                <div style="font-size: 2rem;">üòê</div>
                                <div>Normale</div>
                            </button>
                            <button onclick="App.SessionTracker.submitRating(3)" class="btn btn-secondary">
                                <div style="font-size: 2rem;">üòä</div>
                                <div>Bene</div>
                            </button>
                            <button onclick="App.SessionTracker.submitRating(4)" class="btn btn-secondary">
                                <div style="font-size: 2rem;">üî•</div>
                                <div>Eccellente</div>
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('sessionRatingContent').innerHTML = modalContent;
                document.getElementById('ratingModal').style.display = 'flex';
            },

            submitRating(rating) {
                const sessionNote = document.getElementById('sessionNote').value || '';
                const today = new Date().toDateString();
                const hour = new Date().getHours();
                
                // Initialize rating structure
                if (!App.State.sessionRatings[today]) {
                    App.State.sessionRatings[today] = {};
                }
                if (!App.State.sessionRatings[today][hour]) {
                    App.State.sessionRatings[today][hour] = [];
                }
                
                const sessionData = {
                    rating: rating,
                    note: sessionNote,
                    materia: App.State.currentSessionData?.materia || 'Sessione generica',
                    option: App.State.currentSessionData?.option || '',
                    timestamp: new Date().toISOString(),
                    duration: App.State.timerState.workTime
                };
                
                App.State.sessionRatings[today][hour].push(sessionData);
                App.State.todayDetailedSessions.push(sessionData);
                
                App.saveToStorage();
                
                document.getElementById('ratingModal').style.display = 'none';
                
                App.SessionManager.updateTodayList();
                App.CalendarManager.render();
                App.HeatmapManager.update();
                
                const messages = [
                    'üò¥ Riposa un po\' e riprova pi√π tardi!',
                    'üòê Buon lavoro! La prossima andr√† meglio!',
                    'üòä Ottimo lavoro! Continua cos√¨!',
                    'üî• Fantastico! Sei in zona di massima produttivit√†!'
                ];
                
                App.Utils.showMessage(messages[rating - 1]);
            }
        };

        // === Other Managers (simplified for space) ===
        App.UI = {
            toggleFilter(filter, element) {
                App.State.currentFilter = filter;
                
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                element.classList.add('active');
                
                App.MaterieManager.filter();
            },

            showCustomTimerDialog() {
                document.getElementById('customTimerModal').style.display = 'flex';
            },

            showAddSubjectModal() {
                document.getElementById('addSubjectModal').style.display = 'flex';
            },

            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }
        };

        App.SmartPlanner = {
            generateTodaySchedule() {
                // Simplified version - you can expand this based on your needs
                const oggi = new Date();
                const giornoSettimana = ['domenica', 'lunedi', 'martedi', 'mercoledi', 'giovedi', 'venerdi', 'sabato'][oggi.getDay()];
                
                const materieFiltrate = App.State.materie.filter(materia => {
                    if (materia.status === 'completato') return false;
                    return materia.slotSettimanali?.[giornoSettimana]?.length > 0;
                });

                this.updateTodayDisplay(materieFiltrate);
            },

            updateTodayDisplay(materieOggi) {
                const container = document.getElementById('timelineOggi');
                const taskMateria = document.getElementById('currentTaskMateria');
                const taskTime = document.getElementById('currentTaskTime');
                const startBtn = document.getElementById('startTaskBtn');
                
                if (materieOggi.length === 0) {
                    if (taskMateria) taskMateria.textContent = 'Nessun task programmato';
                    if (taskTime) taskTime.textContent = '‚è±Ô∏è -- min';
                    if (startBtn) startBtn.disabled = true;
                    
                    if (container) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üìÖ</div>
                                <p>Aggiungi materie con slot temporali per vedere il piano giornaliero</p>
                            </div>
                        `;
                    }
                    return;
                }

                // Update current task
                const nextTask = materieOggi[0];
                if (nextTask && taskMateria) {
                    taskMateria.textContent = nextTask.nome;
                    App.State.selectedTaskOption = nextTask.id;
                    App.State.currentSessionData = { materia: nextTask.nome };
                    if (startBtn) startBtn.disabled = false;
                }

                // Update timeline
                if (container) {
                    container.innerHTML = materieOggi.map(materia => `
                        <div class="session-item">
                            <strong>${materia.nome}</strong><br>
                            <small>Priorit√†: ${materia.priorita} | CFU: ${materia.cfu}</small>
                        </div>
                    `).join('');
                }
            }
        };

        // Add remaining managers with simplified implementations
        App.WeeklySlots = {
            initialize() {
                const container = document.getElementById('weeklySlots');
                if (!container) return;
                
                const giorni = ['lunedi', 'martedi', 'mercoledi', 'giovedi', 'venerdi', 'sabato', 'domenica'];
                const giorniLabel = ['Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato', 'Domenica'];

                container.innerHTML = giorni.map((giorno, index) => `
                    <div class="fade-in-up" style="background: var(--bg-tertiary); border-radius: var(--border-radius); padding: 1.5rem; border: 1px solid var(--border);">
                        <h4 style="color: var(--primary-light); margin-bottom: 1rem; text-align: center;">${giorniLabel[index]}</h4>
                        <div id="slots-${giorno}">
                            <button type="button" onclick="App.WeeklySlots.addSlot('${giorno}')" class="btn btn-secondary" style="width: 100%;">+ Aggiungi Slot</button>
                        </div>
                    </div>
                `).join('');
            },

            addSlot(giorno) {
                const container = document.getElementById(`slots-${giorno}`);
                if (!container) return;
                
                const slotId = `${giorno}-${Date.now()}`;
                const slotHTML = `
                    <div id="${slotId}" class="slot-item">
                        <input type="time" value="09:00">
                        <span> - </span>
                        <input type="time" value="11:00">
                        <button onclick="App.WeeklySlots.removeSlot('${slotId}')" class="btn btn-danger btn-small">√ó</button>
                    </div>
                `;
                
                const addButton = container.querySelector('button');
                if (addButton) {
                    addButton.insertAdjacentHTML('beforebegin', slotHTML);
                }
            },

            removeSlot(slotId) {
                const slot = document.getElementById(slotId);
                if (slot) slot.remove();
            },

            get() {
                const giorni = ['lunedi', 'martedi', 'mercoledi', 'giovedi', 'venerdi', 'sabato', 'domenica'];
                const slotSettimanali = {};

                giorni.forEach(giorno => {
                    const container = document.getElementById(`slots-${giorno}`);
                    if (!container) {
                        slotSettimanali[giorno] = [];
                        return;
                    }
                    
                    const slots = container.querySelectorAll('.slot-item');
                    slotSettimanali[giorno] = [];

                    slots.forEach(slot => {
                        const inputs = slot.querySelectorAll('input[type="time"]');
                        if (inputs.length >= 2) {
                            const start = inputs[0].value;
                            const end = inputs[1].value;
                            
                            if (start && end && start < end) {
                                slotSettimanali[giorno].push({
                                    inizio: start,
                                    fine: end,
                                    disponibile: true
                                });
                            }
                        }
                    });
                });

                return slotSettimanali;
            }
        };

        App.StarRating = {
            setup() {
                document.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('mouseover', () => {
                        const rating = parseInt(star.dataset.rating);
                        this.highlight(rating);
                    });
                    
                    star.addEventListener('mouseout', () => {
                        this.update();
                    });
                });

                this.update();
            },

            highlight(rating) {
                document.querySelectorAll('.star').forEach((star, index) => {
                    star.classList.toggle('active', index < rating);
                });
            },

            update() {
                this.highlight(App.State.difficoltaSelezionata);
            }
        };

        // Additional managers (simplified versions)
        App.SessionManager = {
            updateTodayList() {
                const container = document.getElementById('allTodaySessionsList');
                if (!container) return;
                
                if (App.State.todayDetailedSessions.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üçÖ</div>
                            <p>Nessuna sessione completata oggi.</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = App.State.todayDetailedSessions.map((session, index) => `
                    <div class="session-item">
                        <div>
                            <strong>${session.materia}</strong><br>
                            <small>${session.note || 'Nessuna nota'}</small>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="App.SessionManager.delete(${index})">üóëÔ∏è</button>
                    </div>
                `).join('');
            },

            delete(index) {
                if (confirm('Eliminare questa sessione?')) {
                    App.State.todayDetailedSessions.splice(index, 1);
                    App.State.timerState.sessionsToday = Math.max(0, App.State.timerState.sessionsToday - 1);
                    App.saveToStorage();
                    this.updateTodayList();
                    App.TimerManager.updateSessionDisplay();
                }
            },

            deleteAllToday() {
                if (App.State.todayDetailedSessions.length === 0) {
                    App.Utils.showMessage('Non ci sono sessioni da eliminare');
                    return;
                }
                
                if (confirm('Eliminare tutte le sessioni di oggi?')) {
                    App.State.todayDetailedSessions = [];
                    App.State.timerState.sessionsToday = 0;
                    App.saveToStorage();
                    this.updateTodayList();
                    App.TimerManager.updateSessionDisplay();
                    App.Utils.showMessage('Tutte le sessioni eliminate');
                }
            }
        };

        App.CalendarManager = {
            render() {
                const grid = document.getElementById('calendarGrid');
                const monthYearEl = document.getElementById('currentMonthYear');
                
                if (!grid || !monthYearEl) return;
                
                const year = App.State.currentCalendarDate.getFullYear();
                const month = App.State.currentCalendarDate.getMonth();
                
                monthYearEl.textContent = new Date(year, month).toLocaleDateString('it-IT', {
                    month: 'long',
                    year: 'numeric'
                });
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - (firstDay.getDay() + 6) % 7);
                
                grid.innerHTML = '';
                
                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    const dayEl = this.createDayElement(date, month);
                    grid.appendChild(dayEl);
                }
                
                this.updateMonthStats();
            },

            createDayElement(date, currentMonth) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const dateStr = date.toDateString();
                const today = new Date().toDateString();
                
                if (date.getMonth() !== currentMonth) {
                    dayEl.style.opacity = '0.5';
                }
                
                if (dateStr === today) {
                    dayEl.classList.add('today');
                }
                
                const sessions = this.getSessionsForDate(dateStr);
                if (sessions.length > 0) {
                    dayEl.classList.add('has-sessions');
                }
                
                dayEl.innerHTML = `
                    <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">${date.getDate()}</div>
                    ${sessions.length > 0 ? `<small>${sessions.length} sessioni</small>` : ''}
                `;
                
                dayEl.addEventListener('click', () => this.showDayDetail(dateStr, sessions));
                
                return dayEl;
            },

            getSessionsForDate(dateStr) {
                const sessions = [];
                
                if (App.State.sessionRatings[dateStr]) {
                    Object.values(App.State.sessionRatings[dateStr]).forEach(hourSessions => {
                        sessions.push(...hourSessions);
                    });
                }
                
                if (App.State.calendarSessions[dateStr]) {
                    sessions.push(...App.State.calendarSessions[dateStr]);
                }
                
                return sessions;
            },

            showDayDetail(dateStr, sessions) {
                App.State.currentDayDetailDate = dateStr;
                const modal = document.getElementById('dayDetailModal');
                const title = document.getElementById('dayDetailTitle');
                const sessionsList = document.getElementById('daySessionsList');
                
                const date = new Date(dateStr);
                title.textContent = `üìÖ ${date.toLocaleDateString('it-IT', { 
                    weekday: 'long', 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                })}`;
                
                if (sessions.length === 0) {
                    sessionsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <p>Nessuna sessione per questo giorno.</p>
                        </div>
                    `;
                } else {
                    sessionsList.innerHTML = sessions.map(session => `
                        <div class="session-item">
                            <div>
                                <strong>${session.materia || 'Sessione generica'}</strong><br>
                                <small>${session.note || 'Nessuna nota'}</small>
                            </div>
                        </div>
                    `).join('');
                }
                
                modal.style.display = 'flex';
            },

            changeMonth(direction) {
                App.State.currentCalendarDate.setMonth(App.State.currentCalendarDate.getMonth() + direction);
                this.render();
            },

            goToToday() {
                App.State.currentCalendarDate = new Date();
                this.render();
            },

            addManualSession() {
                document.getElementById('sessionDate').value = App.Utils.formatDateForInput(new Date());
                document.getElementById('addSessionModal').style.display = 'flex';
            },

            addSessionToDay() {
                if (!App.State.currentDayDetailDate) return;
                const date = new Date(App.State.currentDayDetailDate);
                document.getElementById('sessionDate').value = App.Utils.formatDateForInput(date);
                document.getElementById('addSessionModal').style.display = 'flex';
            },

            saveManualSession() {
                const dateInput = document.getElementById('sessionDate').value;
                const materia = document.getElementById('sessionMateria').value || 'Sessione generica';
                const duration = parseInt(document.getElementById('sessionDuration').value) || 25;
                const note = document.getElementById('sessionNote').value || '';
                
                if (!dateInput) {
                    App.Utils.showMessage('Seleziona una data', 'error');
                    return;
                }
                
                const date = App.Utils.parseDateFromInput(dateInput);
                const dateStr = date.toDateString();
                
                if (!App.State.calendarSessions[dateStr]) {
                    App.State.calendarSessions[dateStr] = [];
                }
                
                App.State.calendarSessions[dateStr].push({
                    materia,
                    duration,
                    note,
                    timestamp: date.toISOString(),
                    type: 'manual'
                });
                
                App.saveToStorage();
                this.render();
                App.UI.closeModal('addSessionModal');
                App.Utils.showMessage('Sessione aggiunta al calendario!');
            },

            updateMonthStats() {
                const year = App.State.currentCalendarDate.getFullYear();
                const month = App.State.currentCalendarDate.getMonth();
                
                let totalSessions = 0;
                let totalMinutes = 0;
                let activeDays = new Set();
                
                for (let day = 1; day <= new Date(year, month + 1, 0).getDate(); day++) {
                    const date = new Date(year, month, day);
                    const dateStr = date.toDateString();
                    const sessions = this.getSessionsForDate(dateStr);
                    
                    if (sessions.length > 0) {
                        totalSessions += sessions.length;
                        totalMinutes += sessions.reduce((sum, s) => sum + (s.duration || 25), 0);
                        activeDays.add(day);
                    }
                }
                
                const elements = {
                    monthSessions: document.getElementById('monthSessions'),
                    monthHours: document.getElementById('monthHours'),
                    monthDays: document.getElementById('monthDays'),
                    monthAverage: document.getElementById('monthAverage')
                };
                
                if (elements.monthSessions) elements.monthSessions.textContent = totalSessions;
                if (elements.monthHours) elements.monthHours.textContent = `${Math.round(totalMinutes / 60 * 10) / 10}h`;
                if (elements.monthDays) elements.monthDays.textContent = activeDays.size;
                if (elements.monthAverage) elements.monthAverage.textContent = activeDays.size > 0 ? 
                    Math.round(totalSessions / activeDays.size * 10) / 10 : 0;
            }
        };

        App.HeatmapManager = {
            update() {
                const grid = document.getElementById('heatmapGrid');
                if (!grid) return;
                
                grid.innerHTML = '';
                
                for (let hour = 0; hour < 24; hour++) {
                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    cell.textContent = hour.toString().padStart(2, '0');
                    
                    const avgRating = this.calculateHourlyAverageRating(hour);
                    
                    if (avgRating === 0) {
                        cell.classList.add('empty');
                    } else if (avgRating <= 1.5) {
                        cell.classList.add('low');
                    } else if (avgRating <= 2.5) {
                        cell.classList.add('medium');
                    } else if (avgRating <= 3.5) {
                        cell.classList.add('high');
                    } else {
                        cell.classList.add('very-high');
                    }
                    
                    grid.appendChild(cell);
                }
            },

            calculateHourlyAverageRating(hour) {
                let totalRating = 0;
                let sessionCount = 0;
                
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                Object.keys(App.State.sessionRatings).forEach(dateKey => {
                    const date = new Date(dateKey);
                    if (date >= thirtyDaysAgo && App.State.sessionRatings[dateKey][hour]) {
                        App.State.sessionRatings[dateKey][hour].forEach(session => {
                            totalRating += session.rating;
                            sessionCount++;
                        });
                    }
                });
                
                return sessionCount > 0 ? totalRating / sessionCount : 0;
            }
        };

        App.StatisticsManager = {
            update() {
                const container = document.getElementById('statisticheContent');
                if (!container) return;
                
                if (App.State.materie.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <p>Aggiungi delle materie per vedere i tuoi progressi!</p>
                        </div>
                    `;
                    return;
                }
                
                const stats = this.calculateStats();
                
                container.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--primary);">${stats.totalSubjects}</div>
                            <div class="stat-label">Materie Totali</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--success);">${stats.completedSubjects}</div>
                            <div class="stat-label">Materie Completate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--warning);">${stats.totalPages}</div>
                            <div class="stat-label">Pagine Totali</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: var(--secondary);">${stats.studiedPages}</div>
                            <div class="stat-label">Pagine Studiate</div>
                        </div>
                    </div>
                `;
            },
            
            calculateStats() {
                const totalSubjects = App.State.materie.length;
                const completedSubjects = App.State.materie.filter(m => m.status === 'completato').length;
                const totalPages = App.State.materie.reduce((sum, m) => sum + m.pagine, 0);
                const studiedPages = App.State.materie.reduce((sum, m) => sum + (m.pagineStudiate || 0), 0);
                
                return {
                    totalSubjects,
                    completedSubjects,
                    totalPages,
                    studiedPages
                };
            }
        };

        App.ExamManager = {
            updateSection() {
                this.updateStats();
                this.updateList();
            },

            updateStats() {
                const elements = {
                    totalExams: document.getElementById('totalExams'),
                    totalCFU: document.getElementById('totalCFU'),
                    weightedAverage: document.getElementById('weightedAverage'),
                    projectedGrade: document.getElementById('projectedGrade')
                };

                if (App.State.esami.length === 0) {
                    Object.values(elements).forEach(el => {
                        if (el) el.textContent = '0';
                    });
                    return;
                }

                let totalCFU = 0;
                let weightedSum = 0;

                App.State.esami.forEach(esame => {
                    const materia = App.State.materie.find(m => m.id === esame.materiaId);
                    if (materia) {
                        totalCFU += materia.cfu;
                        weightedSum += esame.voto * materia.cfu;
                    }
                });

                const weightedAverage = totalCFU > 0 ? (weightedSum / totalCFU).toFixed(2) : 0;
                const projectedGrade = totalCFU > 0 ? Math.round((weightedSum / totalCFU) * 110 / 30) : 0;

                if (elements.totalExams) elements.totalExams.textContent = App.State.esami.length;
                if (elements.totalCFU) elements.totalCFU.textContent = totalCFU;
                if (elements.weightedAverage) elements.weightedAverage.textContent = weightedAverage;
                if (elements.projectedGrade) elements.projectedGrade.textContent = projectedGrade;
            },

            updateList() {
                const container = document.getElementById('examsList');
                if (!container) return;

                if (App.State.esami.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéì</div>
                            <p>Nessun esame sostenuto ancora.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = App.State.esami.map(esame => {
                    const materia = App.State.materie.find(m => m.id === esame.materiaId);
                    if (!materia) return '';

                    return `
                        <div class="subject-item exam-completed">
                            <div class="flex-between mb-2">
                                <div style="font-size: 1.3rem; font-weight: 700;">${materia.nome}</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--success);">
                                    ${esame.voto}${esame.lode ? 'L' : ''}
                                </div>
                            </div>
                            <div>
                                <strong>CFU:</strong> ${materia.cfu} | 
                                <strong>Data:</strong> ${esame.dataEsame ? new Date(esame.dataEsame).toLocaleDateString('it-IT') : 'Non specificata'}
                            </div>
                        </div>
                    `;
                }).join('');
            },

            saveGrade() {
                const materiaId = parseInt(document.getElementById('examModal').dataset.materiaId);
                const voto = parseInt(document.getElementById('examGrade').value);
                const lode = document.getElementById('examLode').checked;
                const dataEsame = document.getElementById('examDate').value;
                
                if (!voto || voto < 18 || voto > 30) {
                    App.Utils.showMessage('Inserisci un voto valido (18-30)', 'error');
                    return;
                }
                
                const materia = App.State.materie.find(m => m.id === materiaId);
                if (!materia) return;
                
                materia.status = 'completato';
                
                const nuovoEsame = {
                    id: Date.now(),
                    materiaId: materiaId,
                    voto: voto,
                    lode: lode && voto === 30,
                    dataEsame: dataEsame || new Date().toISOString().split('T')[0],
                    dataCreazione: new Date().toISOString()
                };
                
                App.State.esami.push(nuovoEsame);
                App.saveToStorage();
                
                App.MaterieManager.load();
                this.updateSection();
                App.UI.closeModal('examModal');
                
                App.Utils.showMessage(`üéì Esame di ${materia.nome} registrato con voto ${voto}${lode ? 'L' : ''}!`);
            }
        };

        App.CurriculumManager = {
            load() {
                this.renderYears();
                this.showYear(1);
            },

            renderYears() {
                const container = document.getElementById('curriculumContainer');
                if (!container) return;

                container.innerHTML = [1, 2, 3].map(year => `
                    <div id="year-${year}" class="year-content ${year === 1 ? 'active' : ''}">
                        <div class="card fade-in-up">
                            <h3>üéì ${year}¬∞ Anno</h3>
                            <div id="year${year}-subjects">
                                <div class="empty-state">
                                    <div class="empty-state-icon">üìñ</div>
                                    <p>Nessuna materia aggiunta</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                this.loadSubjects();
            },

            loadSubjects() {
                [1, 2, 3].forEach(year => {
                    const yearSubjects = App.State.curriculum.filter(s => s.anno === year);
                    const container = document.getElementById(`year${year}-subjects`);
                    
                    if (!container) return;
                    
                    if (yearSubjects.length === 0) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üìñ</div>
                                <p>Nessuna materia aggiunta</p>
                            </div>
                        `;
                        return;
                    }

                    container.innerHTML = yearSubjects.map(subject => `
                        <div class="session-item">
                            <div>
                                <strong>${subject.nome}</strong><br>
                                <small>CFU: ${subject.cfu} | Semestre: ${subject.semestre}</small>
                            </div>
                            <button class="btn btn-danger btn-small" onclick="App.CurriculumManager.deleteSubject(${subject.id})">üóëÔ∏è</button>
                        </div>
                    `).join('');
                });
            },

            showYear(year, tabElement) {
                // Hide all year contents
                document.querySelectorAll('.year-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show selected year
                const targetContent = document.getElementById(`year-${year}`);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
                
                // Update tab states if in curriculum section
                if (tabElement) {
                    document.querySelectorAll('[data-year]').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    tabElement.classList.add('active');
                }
            },

            saveSubject() {
                const nome = document.getElementById('currSubjectName').value.trim();
                const anno = parseInt(document.getElementById('currSubjectYear').value);
                const semestre = document.getElementById('currSubjectSemester').value;
                const cfu = parseInt(document.getElementById('currSubjectCFU').value);
                
                if (!nome || !anno || !semestre || !cfu) {
                    App.Utils.showMessage('Compila tutti i campi', 'error');
                    return;
                }
                
                const nuovaMateria = {
                    id: Date.now(),
                    nome,
                    anno,
                    semestre,
                    cfu,
                    completato: false,
                    dataCreazione: new Date().toISOString()
                };
                
                App.State.curriculum.push(nuovaMateria);
                App.saveToStorage();
                this.load();
                
                App.UI.closeModal('addSubjectModal');
                document.getElementById('currSubjectForm').reset();
                
                App.Utils.showMessage('Materia aggiunta al curriculum!');
            },

            deleteSubject(id) {
                if (confirm('Eliminare questa materia dal curriculum?')) {
                    App.State.curriculum = App.State.curriculum.filter(s => s.id !== id);
                    App.saveToStorage();
                    this.load();
                    App.Utils.showMessage('Materia eliminata');
                }
            },

            export() {
                const data = JSON.stringify(App.State.curriculum, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `curriculum_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                App.Utils.showMessage('Curriculum esportato!');
            }
        };

        App.PlanManager = {
            generate() {
                const materieFiltrate = App.State.materie.filter(m => m.status !== 'completato');
                
                if (materieFiltrate.length === 0) {
                    this.showEmptyState();
                    return;
                }

                const metrics = this.calculateMetrics(materieFiltrate);
                this.updateOverview(metrics);
                this.generateDetails(materieFiltrate);
            },

            calculateMetrics(materie) {
                let totalWeeklyHours = 0;
                let totalRemainingPages = 0;

                materie.forEach(materia => {
                    if (materia.slotSettimanali) {
                        Object.values(materia.slotSettimanali).forEach(slots => {
                            slots.forEach(slot => {
                                totalWeeklyHours += App.Utils.calculateTaskDuration(slot.inizio, slot.fine) / 60;
                            });
                        });
                    }
                    totalRemainingPages += materia.pagine - (materia.pagineStudiate || 0);
                });

                return {
                    totalWeeklyHours: Math.round(totalWeeklyHours * 10) / 10,
                    avgDailyHours: Math.round((totalWeeklyHours / 7) * 10) / 10,
                    totalRemainingPages,
                    estimatedWeeks: totalWeeklyHours > 0 ? Math.ceil(totalRemainingPages / (totalWeeklyHours * 8)) : 0
                };
            },

            updateOverview(metrics) {
                const elements = {
                    planSummary: document.getElementById('planSummary'),
                    totalWeeklyHours: document.getElementById('totalWeeklyHours'),
                    avgDailyHours: document.getElementById('avgDailyHours'),
                    totalPages: document.getElementById('totalPages'),
                    completionWeeks: document.getElementById('completionWeeks')
                };

                if (elements.planSummary) {
                    elements.planSummary.textContent = `Piano ottimizzato per ${App.State.materie.filter(m => m.status !== 'completato').length} materie`;
                }

                if (elements.totalWeeklyHours) elements.totalWeeklyHours.textContent = `${metrics.totalWeeklyHours}h`;
                if (elements.avgDailyHours) elements.avgDailyHours.textContent = `${metrics.avgDailyHours}h`;
                if (elements.totalPages) elements.totalPages.textContent = metrics.totalRemainingPages;
                if (elements.completionWeeks) elements.completionWeeks.textContent = metrics.estimatedWeeks;
            },

            generateDetails(materie) {
                const container = document.getElementById('pianDetails');
                if (!container) return;

                const sorted = materie
                    .map(m => ({ ...m, priority: App.Utils.calculateSmartPriority(m) }))
                    .sort((a, b) => b.priority - a.priority);

                container.innerHTML = sorted.map(materia => `
                    <div class="subject-item">
                        <h4>${materia.nome}</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${((materia.pagineStudiate || 0) / materia.pagine) * 100}%"></div>
                        </div>
                        <small>
                            Priorit√† Score: ${materia.priority} | 
                            Pagine: ${materia.pagineStudiate || 0}/${materia.pagine} | 
                            CFU: ${materia.cfu}
                        </small>
                    </div>
                `).join('');
            },

            showEmptyState() {
                const container = document.getElementById('pianDetails');
                if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <p>Aggiungi delle materie per generare il tuo piano!</p>
                        </div>
                    `;
                }
            }
        };

        App.HelperManager = {
            prioritizeByDate() {
                const materie = App.State.materie
                    .filter(m => m.status !== 'completato' && m.dataEsame)
                    .sort((a, b) => new Date(a.dataEsame) - new Date(b.dataEsame));
                
                this.showResults('üìÖ Priorit√† per Scadenze', materie);
            },

            prioritizeByDifficulty() {
                const materie = App.State.materie
                    .filter(m => m.status !== 'completato')
                    .sort((a, b) => (b.difficolta || 3) - (a.difficolta || 3));
                
                this.showResults('‚≠ê Priorit√† per Difficolt√†', materie);
            },

            balancedApproach() {
                const materie = App.State.materie
                    .filter(m => m.status !== 'completato')
                    .sort((a, b) => App.Utils.calculateSmartPriority(b) - App.Utils.calculateSmartPriority(a));
                
                this.showResults('‚öñÔ∏è Approccio Bilanciato', materie);
            },

            showResults(title, materie) {
                const container = document.getElementById('helperContent');
                const resultsContainer = document.getElementById('helperResults');
                
                if (!container || materie.length === 0) {
                    App.Utils.showMessage('Aggiungi prima delle materie', 'error');
                    return;
                }

                container.innerHTML = `
                    <h4>${title}</h4>
                    ${materie.map((m, i) => `
                        <div class="session-item">
                            <div>
                                <strong>${i + 1}. ${m.nome}</strong><br>
                                <small>Priorit√†: ${m.priorita} | CFU: ${m.cfu} | Difficolt√†: ${'‚òÖ'.repeat(m.difficolta || 3)}</small>
                            </div>
                        </div>
                    `).join('')}
                `;
                
                resultsContainer.classList.remove('hidden');
            }
        };

        App.SettingsManager = {
            updateAutoBackup() {
                const setting = document.getElementById('autoBackup').value;
                localStorage.setItem('autoBackup', setting);
                App.State.autoBackupEnabled = setting !== 'disabled';
                App.Utils.showMessage('Backup automatico aggiornato');
            },

            updateExamNotifications() {
                const setting = document.getElementById('examNotifications').value;
                localStorage.setItem('examNotifications', setting);
                App.Utils.showMessage('Notifiche esami aggiornate');
            }
        };

        App.DataManager = {
            exportAll() {
                const data = {
                    materie: App.State.materie,
                    esami: App.State.esami,
                    curriculum: App.State.curriculum,
                    calendarSessions: App.State.calendarSessions,
                    sessionRatings: App.State.sessionRatings,
                    exportDate: new Date().toISOString(),
                    version: '3.0'
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `piano_studio_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                App.Utils.showMessage('Backup esportato con successo!');
            },

            importAll() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (confirm('Importare il backup? Questo sostituir√† tutti i dati correnti.')) {
                                App.State.materie = data.materie || [];
                                App.State.esami = data.esami || [];
                                App.State.curriculum = data.curriculum || [];
                                App.State.calendarSessions = data.calendarSessions || {};
                                App.State.sessionRatings = data.sessionRatings || {};
                                
                                App.saveToStorage();
                                App.initializeComponents();
                                
                                App.Utils.showMessage('Dati importati con successo!');
                            }
                        } catch (error) {
                            App.Utils.showMessage('Errore nell\'importazione del file', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            },

            showResetConfirmation() {
                document.getElementById('resetConfirmationModal').style.display = 'flex';
            },

            performReset() {
                const confirmText = document.getElementById('resetConfirmText').value.toUpperCase();
                
                if (confirmText !== 'RESET') {
                    App.Utils.showMessage('Scrivi "RESET" per confermare', 'error');
                    return;
                }

                // Clear all data
                localStorage.clear();
                
                // Reset state
                App.State = {
                    materie: [],
                    esami: [],
                    curriculum: [],
                    calendarSessions: {},
                    sessionRatings: {},
                    timerState: {
                        minutes: 25, seconds: 0, isRunning: false, isBreak: false,
                        workTime: 25, breakTime: 5, sessionsToday: 0,
                        lastSessionDate: '', dailyGoal: 8
                    },
                    studyData: {
                        streak: 0, lastStudyDate: '', totalSessions: 0, missedTime: 0
                    },
                    currentCalendarDate: new Date(),
                    difficoltaSelezionata: 3,
                    timerInterval: null,
                    selectedTaskOption: null,
                    currentSessionData: null,
                    currentEditingExamId: null,
                    currentCurriculumYear: 1,
                    currentDayDetailDate: null,
                    mobileNavOpen: false,
                    currentFilter: 'all',
                    autoBackupEnabled: true,
                    sessionType: null,
                    progressType: null,
                    helperCurrentStrategy: null,
                    todayDetailedSessions: []
                };

                App.initializeComponents();
                App.UI.closeModal('resetConfirmationModal');
                
                App.Utils.showMessage('Reset completo eseguito!');
            }
        };

        App.NotificationManager = {
            checkUpcomingExams() {
                const setting = localStorage.getItem('examNotifications') || '7days';
                if (setting === 'disabled') return;
                
                const today = new Date().toDateString();
                const lastCheck = localStorage.getItem('lastNotificationDate');
                if (lastCheck === today) return;
                
                const daysThreshold = {
                    '1day': 1,
                    '3days': 3,
                    '7days': 7
                }[setting] || 7;
                
                const upcomingExams = App.State.materie.filter(materia => {
                    if (materia.status === 'completato' || !materia.dataEsame) return false;
                    const daysToExam = App.Utils.getDaysToExam(materia.dataEsame);
                    return daysToExam > 0 && daysToExam <= daysThreshold;
                });
                
                if (upcomingExams.length > 0) {
                    const closestExam = upcomingExams.sort((a, b) => 
                        App.Utils.getDaysToExam(a.dataEsame) - App.Utils.getDaysToExam(b.dataEsame)
                    )[0];
                    
                    const daysLeft = App.Utils.getDaysToExam(closestExam.dataEsame);
                    this.show(closestExam.nome, daysLeft);
                    
                    localStorage.setItem('lastNotificationDate', today);
                }
            },
            
            show(subjectName, daysLeft) {
                const banner = document.getElementById('notificationBanner');
                const text = document.getElementById('notificationText');
                
                if (banner && text) {
                    text.textContent = `${subjectName} - ${daysLeft} ${daysLeft === 1 ? 'giorno' : 'giorni'} rimanenti!`;
                    banner.classList.add('show');
                    
                    setTimeout(() => {
                        banner.classList.remove('show');
                    }, 15000);
                }
            },

            hide() {
                const banner = document.getElementById('notificationBanner');
                if (banner) {
                    banner.classList.remove('show');
                    localStorage.setItem('lastNotificationDate', new Date().toDateString());
                }
            }
        };

        App.BackupManager = {
            performAutoBackup() {
                if (!App.State.autoBackupEnabled) return;
                
                try {
                    const backupData = {
                        materie: App.State.materie,
                        esami: App.State.esami,
                        curriculum: App.State.curriculum,
                        calendarSessions: App.State.calendarSessions,
                        sessionRatings: App.State.sessionRatings,
                        backupDate: new Date().toISOString(),
                        version: '3.0'
                    };
                    
                    localStorage.setItem('autoBackup', JSON.stringify(backupData));
                    this.showIndicator();
                } catch (error) {
                    console.error('Errore backup automatico:', error);
                }
            },
            
            showIndicator() {
                const indicator = document.getElementById('backupIndicator');
                if (indicator) {
                    indicator.classList.add('show');
                    setTimeout(() => indicator.classList.remove('show'), 3000);
                }
            }
        };

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
    </script>
</body>
</html>

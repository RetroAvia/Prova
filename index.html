<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceAI - Gestione Finanze Personali</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/index.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --primary-ultra-light: #60a5fa;
            --secondary-color: #0f172a;
            --accent-color: #06d6a0;
            --accent-dark: #04a777;
            --danger-color: #ef4444;
            --danger-dark: #dc2626;
            --warning-color: #f59e0b;
            --success-color: #10b981;
            --text-primary: #f8fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #94a3b8;
            --background: #020617;
            --background-light: #0f172a;
            --background-card: #1e293b;
            --surface: #334155;
            --surface-light: #475569;
            --border: #475569;
            --border-light: #64748b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            --shadow-glow: 0 0 20px rgba(37, 99, 235, 0.3);
            --border-radius: 20px;
            --border-radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --blur: blur(24px);
            --backdrop-blur: blur(16px);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: 
                radial-gradient(ellipse at top left, rgba(37, 99, 235, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at top right, rgba(6, 214, 160, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom left, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #020617 0%, #0f172a 25%, #1e293b 50%, #0f172a 75%, #020617 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 400% 400%;
            background-attachment: fixed;
            min-height: 100vh;
            animation: backgroundFlow 30s ease infinite;
            overflow-x: hidden;
        }

        @keyframes backgroundFlow {
            0%, 100% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 50%; }
            25% { background-position: 0% 0%, 0% 0%, 0% 0%, 100% 50%; }
            50% { background-position: 0% 0%, 0% 0%, 0% 0%, 100% 0%; }
            75% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%; }
        }

        .gpu-accelerated {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 10px;
            backdrop-filter: var(--backdrop-blur);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
            transition: var(--transition);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--success-color));
            box-shadow: var(--shadow-glow);
        }

        .header {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: var(--blur);
            border-bottom: 1px solid rgba(75, 85, 99, 0.2);
            padding: 1.25rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-ultra-light), var(--accent-color), var(--primary-light));
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: logoGlow 3s ease-in-out infinite;
            position: relative;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 50%;
            opacity: 0.3;
            filter: blur(8px);
            z-index: -1;
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes pulseGlow {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: var(--blur);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            border: 1px solid rgba(75, 85, 99, 0.2);
            box-shadow: var(--shadow);
        }

        .nav-tab {
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-muted);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: var(--transition-fast);
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
            background: rgba(51, 65, 85, 0.5);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow-glow);
            transform: scale(1.05);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 2px;
            background: var(--accent-color);
            border-radius: 2px;
            box-shadow: 0 0 10px var(--accent-color);
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            display: grid;
            gap: 2rem;
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: var(--blur);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(75, 85, 99, 0.2);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            opacity: 0;
            transition: var(--transition);
        }

        .card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.03) 0%, transparent 70%);
            opacity: 0;
            transition: var(--transition);
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            border-color: rgba(37, 99, 235, 0.3);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover::after {
            opacity: 1;
        }

        .card-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(75, 85, 99, 0.2);
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            position: relative;
            backdrop-filter: var(--backdrop-blur);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.375rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-primary);
        }

        .card-title i {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary-light), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-body {
            padding: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            text-align: center;
            padding: 2.5rem 2rem;
            position: relative;
            overflow: hidden;
            background: rgba(30, 41, 59, 0.4);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(37, 99, 235, 0.1), transparent 70%);
            opacity: 0;
            transition: var(--transition);
        }

        .stat-card:hover::after {
            opacity: 1;
            animation: ripple 0.6s ease-out;
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
            transition: var(--transition);
            letter-spacing: -0.02em;
        }

        .stat-card:hover .stat-value {
            transform: scale(1.1);
            text-shadow: 0 0 30px currentColor;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-weight: 600;
            opacity: 0.8;
        }

        .stat-positive { 
            color: var(--accent-color); 
            text-shadow: 0 0 25px rgba(6, 214, 160, 0.4);
        }
        .stat-negative { 
            color: var(--danger-color);
            text-shadow: 0 0 25px rgba(239, 68, 68, 0.4);
        }
        .stat-neutral { 
            color: var(--primary-light);
            text-shadow: 0 0 25px rgba(59, 130, 246, 0.4);
        }

        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: var(--backdrop-blur);
            color: var(--text-primary);
            position: relative;
        }

        .form-input::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 
                0 0 0 4px rgba(37, 99, 235, 0.15),
                var(--shadow-lg),
                inset 0 1px 2px rgba(0,0,0,0.1);
            transform: translateY(-2px) scale(1.02);
            background: rgba(30, 41, 59, 0.8);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .search-container {
            position: relative;
            margin-bottom: 2rem;
        }

        .search-input {
            padding-left: 3.5rem;
            background: rgba(30, 41, 59, 0.4);
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        .search-input:focus {
            background: rgba(30, 41, 59, 0.8);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            z-index: 1;
            font-size: 1.125rem;
            transition: var(--transition);
        }

        .search-container:focus-within .search-icon {
            color: var(--primary-light);
            animation: searchPulse 0.5s ease-out;
        }

        @keyframes searchPulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.2); }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            min-width: 120px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn:active::before {
            width: 400px;
            height: 400px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.6);
            backdrop-filter: var(--backdrop-blur);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(71, 85, 105, 0.8);
            border-color: var(--primary-color);
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), var(--danger-dark));
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #f87171, var(--danger-color));
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, var(--success-color), var(--accent-color));
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(6, 214, 160, 0.3);
        }

        .btn-sm {
            padding: 0.75rem 1.5rem;
            font-size: 0.75rem;
            min-width: 100px;
        }

        .btn-floating {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            z-index: 1000;
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            animation: float 4s ease-in-out infinite;
            backdrop-filter: var(--blur);
            border: 2px solid rgba(255,255,255,0.1);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(5deg); }
            50% { transform: translateY(-20px) rotate(0deg); }
            75% { transform: translateY(-10px) rotate(-5deg); }
        }

        .btn-floating:hover {
            animation: floatHover 0.3s ease-out forwards;
        }

        @keyframes floatHover {
            from { transform: translateY(0) scale(1); }
            to { transform: translateY(-5px) scale(1.1); }
        }

        .transaction-list {
            max-height: 600px;
            overflow-y: auto;
            border-radius: var(--border-radius-sm);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(75, 85, 99, 0.2);
            transition: var(--transition);
            position: relative;
            backdrop-filter: var(--backdrop-blur);
        }

        .transaction-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            transform: scaleY(0);
            transform-origin: bottom;
            transition: var(--transition);
        }

        .transaction-item:hover {
            background: rgba(51, 65, 85, 0.3);
            transform: translateX(8px) scale(1.02);
            box-shadow: var(--shadow);
        }

        .transaction-item:hover::before {
            transform: scaleY(1);
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .transaction-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .transaction-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: iconShine 3s infinite;
        }

        @keyframes iconShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .transaction-details h4 {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 1.125rem;
        }

        .transaction-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .transaction-amount {
            font-weight: 700;
            text-align: right;
            font-size: 1.25rem;
            letter-spacing: -0.02em;
        }

        .transaction-actions {
            display: flex;
            gap: 0.75rem;
            opacity: 0;
            transform: translateX(20px);
            transition: var(--transition);
        }

        .transaction-item:hover .transaction-actions {
            opacity: 1;
            transform: translateX(0);
        }

        .ai-insight {
            background: 
                radial-gradient(ellipse at top left, rgba(37, 99, 235, 0.2) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(6, 214, 160, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            backdrop-filter: var(--blur);
            color: white;
            padding: 2.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(37, 99, 235, 0.3);
            box-shadow: var(--shadow-xl);
        }

        .ai-insight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 25% 25%, rgba(37, 99, 235, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(6, 214, 160, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.2) 0%, transparent 50%);
            animation: aiBackground 8s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes aiBackground {
            0%, 100% { opacity: 0.7; }
            33% { opacity: 1; }
            66% { opacity: 0.8; }
        }

        .ai-insight-content {
            position: relative;
            z-index: 1;
        }

        .ai-insight-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .ai-insight-title i {
            font-size: 2rem;
            animation: aiPulse 2s infinite ease-in-out;
            background: linear-gradient(135deg, var(--primary-light), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes aiPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .chart-container {
            position: relative;
            height: 400px;
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.3);
            border-radius: var(--border-radius-sm);
            backdrop-filter: var(--backdrop-blur);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--border);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .calendar-day {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: var(--backdrop-blur);
            padding: 1.25rem 1rem;
            min-height: 120px;
            position: relative;
            transition: var(--transition);
            border: 1px solid transparent;
            cursor: pointer;
        }

        .calendar-day:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: var(--primary-color);
            transform: scale(1.02);
            box-shadow: var(--shadow);
        }

        .calendar-day-number {
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-size: 1.125rem;
        }

        .calendar-event {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.375rem 0.5rem;
            border-radius: 6px;
            margin-bottom: 0.375rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            animation: slideInScale 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        @keyframes slideInScale {
            from { transform: scale(0.8) translateY(-10px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .goal-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: var(--blur);
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid rgba(75, 85, 99, 0.2);
            transition: var(--transition);
        }

        .goal-header {
            padding: 2rem;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(6, 214, 160, 0.1));
            border-bottom: 1px solid rgba(75, 85, 99, 0.2);
        }

        .goal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .goal-status {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }

        .goal-status.completed {
            background: linear-gradient(135deg, var(--success-color), var(--accent-color));
            color: white;
        }

        .goal-status.in-progress {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
        }

        .goal-status.expired {
            background: linear-gradient(135deg, var(--danger-color), var(--warning-color));
            color: white;
        }

        .goal-body {
            padding: 2rem;
        }

        .goal-progress-section {
            margin-bottom: 2rem;
        }

        .goal-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .goal-amounts {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .goal-percentage {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-color), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .enhanced-progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 1rem;
        }

        .enhanced-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color), var(--success-color));
            border-radius: 10px;
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 15px rgba(6, 214, 160, 0.6);
        }

        .enhanced-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: progressShine 3s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .goal-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .goal-detail-item {
            text-align: center;
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.4);
            border-radius: var(--border-radius-sm);
            border: 1px solid rgba(75, 85, 99, 0.2);
        }

        .goal-detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .goal-detail-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .goal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .amount-btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--success-color);
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .amount-btn:hover {
            background: var(--success-color);
            color: white;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }

        .amount-btn.negative {
            border-color: var(--warning-color);
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .amount-btn.negative:hover {
            background: var(--warning-color);
            color: white;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }

        .balance-card {
            background: 
                radial-gradient(ellipse at top left, rgba(6, 214, 160, 0.2) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(37, 99, 235, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(6, 214, 160, 0.3);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(6, 214, 160, 0.2);
        }

        .balance-input-group {
            display: flex;
            gap: 1rem;
            align-items: end;
        }

        .balance-input {
            flex: 1;
        }

        .balance-btn {
            height: 58px;
            padding: 0 2rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: var(--blur);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: var(--blur);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            border: 1px solid rgba(37, 99, 235, 0.2);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.8) translateY(50px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(75, 85, 99, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            backdrop-filter: var(--backdrop-blur);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.2);
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--danger-color);
            padding: 0.75rem;
            border-radius: 50%;
            transition: var(--transition);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--danger-color);
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .modal-body {
            padding: 2.5rem 2rem;
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 3000;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: var(--blur);
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-xl);
            border-left: 4px solid var(--primary-color);
            color: var(--text-primary);
            animation: slideInNotification 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 300px;
            font-weight: 500;
        }

        @keyframes slideInNotification {
            from { transform: translateX(400px) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }

        .notification.success { 
            border-left-color: var(--accent-color); 
            box-shadow: var(--shadow-xl), 0 0 20px rgba(6, 214, 160, 0.2);
        }
        .notification.error { 
            border-left-color: var(--danger-color); 
            box-shadow: var(--shadow-xl), 0 0 20px rgba(239, 68, 68, 0.2);
        }
        .notification.info {
            border-left-color: var(--primary-light);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(59, 130, 246, 0.2);
        }

        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-4 { margin-top: 1.5rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .gap-2 { gap: 0.5rem; }
        .font-weight-600 { font-weight: 600; }
        .flex-wrap { flex-wrap: wrap; }

        @media (max-width: 1200px) {
            .container {
                max-width: 100%;
                padding: 0 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 1rem auto;
                padding: 0 0.75rem;
                gap: 1.5rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1.5rem;
                padding: 0 1rem;
            }
            
            .nav-tabs {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            
            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
                min-width: auto;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .goal-details {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .balance-input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .balance-btn {
                height: auto;
                padding: 1rem 2rem;
            }
            
            .transaction-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                padding: 1.25rem;
            }
            
            .transaction-actions {
                opacity: 1;
                transform: translateX(0);
                align-self: flex-end;
            }
            
            .btn-floating {
                bottom: 1rem;
                right: 1rem;
                width: 60px;
                height: 60px;
            }

            .stat-value {
                font-size: 2.25rem;
            }

            .card-header, .card-body {
                padding: 1.5rem;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }

            .modal-header, .modal-body {
                padding: 1.5rem;
            }

            .logo {
                font-size: 1.75rem;
            }

            .calendar-day {
                min-height: 80px;
                padding: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .stat-value {
                font-size: 2rem;
            }

            .nav-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .btn {
                padding: 0.875rem 1.5rem;
                font-size: 0.8rem;
            }

            .card-title {
                font-size: 1.125rem;
            }

            .chart-container {
                height: 300px;
                padding: 1rem;
            }

            .goal-actions {
                grid-template-columns: 1fr;
            }
        }

        .stagger-animation .card:nth-child(1) { animation-delay: 0.05s; }
        .stagger-animation .card:nth-child(2) { animation-delay: 0.1s; }
        .stagger-animation .card:nth-child(3) { animation-delay: 0.15s; }
        .stagger-animation .card:nth-child(4) { animation-delay: 0.2s; }

        .slide-in-left {
            animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes slideOutNotification {
            from { transform: translateX(0) scale(1); opacity: 1; }
            to { transform: translateX(400px) scale(0.8); opacity: 0; }
        }

        @media (prefers-contrast: high) {
            :root {
                --text-primary: #ffffff;
                --text-secondary: #e5e7eb;
                --border: #6b7280;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .btn:focus-visible,
        .nav-tab:focus-visible,
        .form-input:focus-visible,
        .form-select:focus-visible {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                FinanceAI
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard', this)">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-tab" onclick="showTab('transactions', this)">
                    <i class="fas fa-exchange-alt"></i> Transazioni
                </button>
                <button class="nav-tab" onclick="showTab('analytics', this)">
                    <i class="fas fa-chart-bar"></i> Analytics
                </button>
                <button class="nav-tab" onclick="showTab('calendar', this)">
                    <i class="fas fa-calendar"></i> Calendario
                </button>
                <button class="nav-tab" onclick="showTab('goals', this)">
                    <i class="fas fa-target"></i> Obiettivi
                </button>
            </nav>
        </div>
    </header>

    <!-- Floating Action Button -->
    <button class="btn btn-primary btn-floating gpu-accelerated" onclick="showQuickActions()" title="Azioni Rapide">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Main Container -->
    <main class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <!-- Initial Balance Card -->
            <div class="card balance-card slide-in-left gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-wallet"></i>
                        Patrimonio Iniziale
                    </h3>
                </div>
                <div class="card-body">
                    <p class="mb-4" style="color: var(--text-secondary); line-height: 1.6;">
                        Imposta il tuo patrimonio iniziale (denaro che già possiedi) separatamente dalle transazioni quotidiane.
                    </p>
                    <div class="balance-input-group">
                        <div class="balance-input">
                            <label class="form-label">Patrimonio Attuale (€)</label>
                            <input type="number" step="0.01" class="form-input" id="initial-balance" 
                                   placeholder="0.00" onchange="updateInitialBalance()">
                        </div>
                        <button class="btn btn-success balance-btn" onclick="updateInitialBalance()">
                            <i class="fas fa-save"></i> Aggiorna
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Dashboard -->
            <div class="dashboard-grid stagger-animation">
                <div class="card stat-card bounce-in gpu-accelerated">
                    <div class="stat-value stat-neutral" id="initial-balance-display">€0</div>
                    <div class="stat-label">Patrimonio Iniziale</div>
                </div>
                <div class="card stat-card bounce-in gpu-accelerated">
                    <div class="stat-value stat-positive" id="total-income">€0</div>
                    <div class="stat-label">Entrate Totali</div>
                </div>
                <div class="card stat-card bounce-in gpu-accelerated">
                    <div class="stat-value stat-negative" id="total-expenses">€0</div>
                    <div class="stat-label">Spese Totali</div>
                </div>
                <div class="card stat-card bounce-in gpu-accelerated">
                    <div class="stat-value stat-neutral" id="total-balance">€0</div>
                    <div class="stat-label">Patrimonio Totale</div>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="ai-insight slide-in-left gpu-accelerated">
                <div class="ai-insight-content">
                    <div class="ai-insight-title">
                        <i class="fas fa-robot"></i>
                        Insights AI Personalizzati
                    </div>
                    <div id="ai-insights">
                        Benvenuto in FinanceAI! Inizia aggiungendo alcune transazioni per ricevere insights personalizzati e consigli intelligenti sui tuoi comportamenti di spesa.
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card slide-in-right gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-bolt"></i>
                        Azioni Rapide
                    </h3>
                </div>
                <div class="card-body">
                    <div class="flex gap-2 flex-wrap">
                        <button class="btn btn-success" onclick="openTransactionModal('income')">
                            <i class="fas fa-arrow-up"></i> Aggiungi Entrata
                        </button>
                        <button class="btn btn-danger" onclick="openTransactionModal('expense')">
                            <i class="fas fa-arrow-down"></i> Aggiungi Spesa
                        </button>
                        <button class="btn btn-primary" onclick="generateAIInsights()">
                            <i class="fas fa-magic"></i> Genera Insights AI
                        </button>
                        <button class="btn btn-secondary" onclick="exportData()">
                            <i class="fas fa-download"></i> Esporta Dati
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="card gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-history"></i>
                        Transazioni Recenti
                    </h3>
                    <button class="btn btn-secondary btn-sm" onclick="showTab('transactions')">
                        Vedi Tutto
                    </button>
                </div>
                <div class="card-body">
                    <div id="recent-transactions">
                        <p class="text-center">Nessuna transazione ancora. Aggiungi la prima!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions-tab" class="tab-content hidden">
            <div class="card gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-list"></i>
                        Gestione Transazioni
                    </h3>
                    <div class="flex gap-2">
                        <button class="btn btn-success btn-sm" onclick="openTransactionModal('income')">
                            <i class="fas fa-plus"></i> Entrata
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="openTransactionModal('expense')">
                            <i class="fas fa-plus"></i> Spesa
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Enhanced Search and Filters -->
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-input search-input" id="transaction-search" 
                               placeholder="Cerca transazioni..." onkeyup="searchTransactions()">
                    </div>
                    
                    <div class="form-row mb-4">
                        <div class="form-group">
                            <label class="form-label">Filtra per Categoria</label>
                            <select class="form-select" id="category-filter" onchange="filterTransactions()">
                                <option value="">Tutte le categorie</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Filtra per Tipo</label>
                            <select class="form-select" id="type-filter" onchange="filterTransactions()">
                                <option value="">Tutti i tipi</option>
                                <option value="income">Entrate</option>
                                <option value="expense">Spese</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="transaction-list" id="all-transactions">
                        <p class="text-center">Nessuna transazione trovata.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content hidden">
            <div class="card mb-4 slide-in-left gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Andamento Finanziario
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="monthly-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card slide-in-left gpu-accelerated">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Distribuzione Spese
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="category-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card slide-in-right gpu-accelerated">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-balance-scale"></i>
                            Bilancio Mensile
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="income-expense-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar-tab" class="tab-content hidden">
            <div class="card gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-alt"></i>
                        Calendario Finanziario
                    </h3>
                    <div class="flex items-center gap-2">
                        <button class="btn btn-secondary btn-sm" onclick="changeMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="current-month" class="font-weight-600"></span>
                        <button class="btn btn-secondary btn-sm" onclick="changeMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Tab -->
        <div id="goals-tab" class="tab-content hidden">
            <div class="card gpu-accelerated">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-bullseye"></i>
                        Obiettivi di Risparmio
                    </h3>
                    <button class="btn btn-primary" onclick="openGoalModal()">
                        <i class="fas fa-plus"></i> Nuovo Obiettivo
                    </button>
                </div>
                <div class="card-body" id="goals-container">
                    <p class="text-center">Nessun obiettivo impostato. Crea il primo!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Quick Actions Modal -->
    <div class="modal" id="quick-actions-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Azioni Rapide</h3>
                <button class="modal-close" onclick="closeModal('quick-actions-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; gap: 1.5rem;">
                    <button class="btn btn-success" onclick="openTransactionModal('income'); closeModal('quick-actions-modal')">
                        <i class="fas fa-arrow-up"></i> Nuova Entrata
                    </button>
                    <button class="btn btn-danger" onclick="openTransactionModal('expense'); closeModal('quick-actions-modal')">
                        <i class="fas fa-arrow-down"></i> Nuova Spesa
                    </button>
                    <button class="btn btn-primary" onclick="generateAIInsights(); closeModal('quick-actions-modal')">
                        <i class="fas fa-magic"></i> Insights AI
                    </button>
                    <button class="btn btn-secondary" onclick="exportData(); closeModal('quick-actions-modal')">
                        <i class="fas fa-download"></i> Esporta Dati
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div class="modal" id="transaction-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Nuova Transazione</h3>
                <button class="modal-close" onclick="closeModal('transaction-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="transaction-form" onsubmit="handleTransactionSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Descrizione</label>
                        <input type="text" class="form-input" id="transaction-description" 
                               placeholder="Es. Spesa supermercato, Stipendio..." required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Importo (€)</label>
                            <input type="number" step="0.01" class="form-input" id="transaction-amount" 
                                   placeholder="0.00" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data</label>
                            <input type="date" class="form-input" id="transaction-date" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="transaction-category" required>
                            <!-- Categories will be populated by JS -->
                        </select>
                    </div>
                    
                    <input type="hidden" id="transaction-type">
                    <input type="hidden" id="transaction-id">
                    
                    <div class="flex justify-between">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('transaction-modal')">
                            <i class="fas fa-times"></i> Annulla
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salva Transazione
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div class="modal" id="goal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nuovo Obiettivo</h3>
                <button class="modal-close" onclick="closeModal('goal-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="goal-form" onsubmit="handleGoalSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Nome Obiettivo</label>
                        <input type="text" class="form-input" id="goal-name" 
                               placeholder="Es. Vacanza estiva, Auto nuova..." required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Importo Target (€)</label>
                            <input type="number" step="0.01" class="form-input" id="goal-target" 
                                   placeholder="0.00" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Obiettivo</label>
                            <input type="date" class="form-input" id="goal-date" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descrizione (opzionale)</label>
                        <input type="text" class="form-input" id="goal-description"
                               placeholder="Dettagli aggiuntivi...">
                    </div>
                    
                    <input type="hidden" id="goal-id">
                    
                    <div class="flex justify-between">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('goal-modal')">
                            <i class="fas fa-times"></i> Annulla
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salva Obiettivo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Global Variables - Ottimizzate per performance
        const CATEGORIES = Object.freeze({
            income: [
                'Stipendio', 'Freelance', 'Investimenti', 'Dividendi', 'Affitto Passivo',
                'Bonus', 'Regali', 'Vendite', 'Rimborsi', 'Altro'
            ],
            expense: [
                'Alimentari', 'Bollette', 'Affitto/Mutuo', 'Trasporti', 'Carburante',
                'Salute', 'Farmacia', 'Intrattenimento', 'Abbigliamento', 'Tecnologia',
                'Viaggi', 'Ristoranti', 'Educazione', 'Sport/Fitness', 'Casa/Manutenzione',
                'Assicurazioni', 'Tasse', 'Regali', 'Altro'
            ]
        });

        const CATEGORY_COLORS = Object.freeze({
            'Stipendio': '#06d6a0', 'Freelance': '#04a777', 'Investimenti': '#059669',
            'Dividendi': '#10b981', 'Affitto Passivo': '#14b8a6', 'Bonus': '#0d9488',
            'Regali': '#2563eb', 'Vendite': '#3b82f6', 'Rimborsi': '#60a5fa', 'Altro': '#8b5cf6',
            'Alimentari': '#ef4444', 'Bollette': '#dc2626', 'Affitto/Mutuo': '#b91c1c',
            'Trasporti': '#f59e0b', 'Carburante': '#d97706', 'Salute': '#ea580c',
            'Farmacia': '#c2410c', 'Intrattenimento': '#7c3aed', 'Abbigliamento': '#a855f7',
            'Tecnologia': '#8b5cf6', 'Viaggi': '#c084fc', 'Ristoranti': '#ec4899',
            'Educazione': '#db2777', 'Sport/Fitness': '#be185d', 'Casa/Manutenzione': '#9d174d',
            'Assicurazioni': '#831843', 'Tasse': '#701a75'
        });

        // Performance optimized - no localStorage dependency
        let appData = {
            transactions: [],
            goals: [],
            initialBalance: 0,
            settings: { currency: 'EUR', theme: 'dark', notifications: true }
        };

        let currentTab = 'dashboard';
        let currentMonth = new Date();
        let charts = {};
        
        // Ottimizzazione: Debouncing per search e resize
        let searchTimeout = null;
        let resizeTimeout = null;

        // Error Handlers - Migliorati
        window.addEventListener('error', function(e) {
            console.error('Errore applicazione:', e.error);
            showNotification('Si è verificato un errore. Ricarica la pagina se il problema persiste.', 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rejection:', e.reason);
            e.preventDefault();
        });

        // Performance: Resize event optimization
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                if (currentTab === 'analytics' && Object.keys(charts).length > 0) {
                    Object.values(charts).forEach(chart => {
                        if (chart && typeof chart.resize === 'function') {
                            chart.resize();
                        }
                    });
                }
            }, 250);
        });

        // Modal click-outside to close
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });

        // Utility Functions - Ottimizzate
        const formatCurrency = (function() {
            const formatter = new Intl.NumberFormat('it-IT', {
                style: 'currency',
                currency: 'EUR'
            });
            return function(amount) {
                return formatter.format(amount || 0);
            };
        })();

        const formatDate = (function() {
            const formatter = new Intl.DateTimeFormat('it-IT');
            return function(date) {
                return formatter.format(new Date(date));
            };
        })();

        function formatDateRelative(date) {
            const now = new Date();
            const diffTime = now - new Date(date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Oggi';
            if (diffDays === 1) return 'Ieri';
            if (diffDays < 7) return `${diffDays} giorni fa`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} settimane fa`;
            return formatDate(date);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function saveData() {
            // Memory storage for Claude.ai - no localStorage
            console.log('Data saved to memory');
        }

        function loadData() {
            return appData;
        }

        function showNotification(message, type = 'info') {
            if (!message) return;
            
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutNotification 0.6s ease-in forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 600);
            }, 4000);
        }

        // Initial Balance Management
        function updateInitialBalance() {
            const balanceInput = document.getElementById('initial-balance');
            const newBalance = parseFloat(balanceInput.value) || 0;
            
            if (newBalance < 0) {
                showNotification('Il patrimonio iniziale non può essere negativo', 'error');
                return;
            }
            
            appData.initialBalance = newBalance;
            saveData();
            updateDashboard();
            
            showNotification('Patrimonio iniziale aggiornato con successo!', 'success');
        }

        function loadInitialBalance() {
            const balanceInput = document.getElementById('initial-balance');
            const balanceDisplay = document.getElementById('initial-balance-display');
            
            if (balanceInput && balanceDisplay) {
                balanceInput.value = appData.initialBalance || 0;
                balanceDisplay.textContent = formatCurrency(appData.initialBalance || 0);
            }
        }

        // Tab Management - Ottimizzato
        function showTab(tabName, clickedElement) {
            if (!tabName || currentTab === tabName) return;
            
            // Fade out current content
            const container = document.querySelector('.container');
            if (container) {
                container.style.opacity = '0.7';
            }
            
            requestAnimationFrame(() => {
                setTimeout(() => {
                    // Hide all tabs
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.add('hidden');
                    });
                    
                    // Remove active from all nav tabs
                    document.querySelectorAll('.nav-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // Show target tab
                    const targetTab = document.getElementById(tabName + '-tab');
                    if (targetTab) {
                        targetTab.classList.remove('hidden');
                    }
                    
                    // Set active nav tab
                    if (clickedElement) {
                        clickedElement.classList.add('active');
                    }
                    
                    currentTab = tabName;
                    
                    // Tab-specific initialization
                    switch(tabName) {
                        case 'analytics':
                            setTimeout(updateCharts, 100); // Delay for DOM rendering
                            break;
                        case 'calendar':
                            renderCalendar();
                            break;
                        case 'goals':
                            renderGoals();
                            break;
                        case 'transactions':
                            renderAllTransactions();
                            populateCategoryFilters();
                            break;
                        case 'dashboard':
                            updateDashboard();
                            loadInitialBalance();
                            break;
                    }
                    
                    // Fade in new content
                    if (container) {
                        container.style.opacity = '1';
                    }
                }, 50);
            });
        }

        // Modal Management
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Focus management
                const firstFocusable = modal.querySelector('input, button, select, textarea');
                if (firstFocusable) {
                    setTimeout(() => firstFocusable.focus(), 100);
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function showQuickActions() {
            openModal('quick-actions-modal');
        }

        function openTransactionModal(type, transaction = null) {
            if (!type) return;
            
            const modal = document.getElementById('transaction-modal');
            const form = document.getElementById('transaction-form');
            const titleElement = document.getElementById('modal-title');
            const categorySelect = document.getElementById('transaction-category');
            
            if (!modal || !form || !titleElement || !categorySelect) return;
            
            form.reset();
            
            // Set today's date
            const dateInput = document.getElementById('transaction-date');
            if (dateInput) {
                const today = new Date();
                const year = today.getFullYear();
                const monthNum = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                dateInput.value = `${year}-${monthNum}-${day}`;
            }
            
            // Populate categories
            categorySelect.innerHTML = '';
            const categories = CATEGORIES[type] || [];
            
            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                fragment.appendChild(option);
            });
            categorySelect.appendChild(fragment);
            
            // Fill form if editing
            if (transaction) {
                titleElement.textContent = 'Modifica Transazione';
                const idInput = document.getElementById('transaction-id');
                const descInput = document.getElementById('transaction-description');
                const amountInput = document.getElementById('transaction-amount');
                const dateEditInput = document.getElementById('transaction-date');
                
                if (idInput) idInput.value = transaction.id;
                if (descInput) descInput.value = transaction.description;
                if (amountInput) amountInput.value = Math.abs(transaction.amount);
                if (dateEditInput) dateEditInput.value = transaction.date;
                if (categorySelect) categorySelect.value = transaction.category;
            } else {
                titleElement.textContent = type === 'income' ? 'Nuova Entrata' : 'Nuova Spesa';
                const idInput = document.getElementById('transaction-id');
                if (idInput) idInput.value = '';
            }
            
            const typeInput = document.getElementById('transaction-type');
            if (typeInput) typeInput.value = type;
            
            openModal('transaction-modal');
        }

        function openGoalModal(goal = null) {
            const form = document.getElementById('goal-form');
            if (!form) return;
            
            form.reset();
            
            if (goal) {
                const fields = ['goal-id', 'goal-name', 'goal-target', 'goal-date', 'goal-description'];
                const values = [goal.id, goal.name, goal.target, goal.date, goal.description || ''];
                
                fields.forEach((fieldId, index) => {
                    const field = document.getElementById(fieldId);
                    if (field && values[index] !== undefined) {
                        field.value = values[index];
                    }
                });
            } else {
                const idInput = document.getElementById('goal-id');
                const dateInput = document.getElementById('goal-date');
                
                if (idInput) idInput.value = '';
                if (dateInput) {
                    const nextMonth = new Date();
                    nextMonth.setMonth(nextMonth.getMonth() + 1);
                    const year = nextMonth.getFullYear();
                    const monthNum = String(nextMonth.getMonth() + 1).padStart(2, '0');
                    const day = String(nextMonth.getDate()).padStart(2, '0');
                    dateInput.value = `${year}-${monthNum}-${day}`;
                }
            }
            
            openModal('goal-modal');
        }

        // Transaction Management
        function handleTransactionSubmit(e) {
            if (e) e.preventDefault();
            
            const submitBtn = e ? e.target.querySelector('button[type="submit"]') : null;
            const originalText = submitBtn ? submitBtn.innerHTML : '';
            
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
                submitBtn.disabled = true;
            }
            
            setTimeout(() => {
                try {
                    const idInput = document.getElementById('transaction-id');
                    const typeInput = document.getElementById('transaction-type');
                    const descInput = document.getElementById('transaction-description');
                    const amountInput = document.getElementById('transaction-amount');
                    const dateInput = document.getElementById('transaction-date');
                    const categoryInput = document.getElementById('transaction-category');
                    
                    if (!typeInput || !descInput || !amountInput || !dateInput || !categoryInput) {
                        throw new Error('Campi del form mancanti');
                    }
                    
                    const id = idInput ? idInput.value : '';
                    const type = typeInput.value;
                    const description = descInput.value;
                    const amount = parseFloat(amountInput.value);
                    const date = dateInput.value;
                    const category = categoryInput.value;
                    
                    if (!type || !description || isNaN(amount) || !date || !category) {
                        throw new Error('Dati del form non validi');
                    }
                    
                    const transaction = {
                        id: id || generateId(),
                        type,
                        description,
                        amount: type === 'expense' ? -Math.abs(amount) : Math.abs(amount),
                        date,
                        category,
                        createdAt: new Date().toISOString()
                    };
                    
                    if (id) {
                        const index = appData.transactions.findIndex(t => t.id === id);
                        if (index !== -1) {
                            appData.transactions[index] = transaction;
                        }
                    } else {
                        appData.transactions.push(transaction);
                    }
                    
                    saveData();
                    updateDashboard();
                    renderAllTransactions();
                    closeModal('transaction-modal');
                    
                    showNotification(`Transazione ${id ? 'aggiornata' : 'aggiunta'} con successo!`, 'success');
                    
                } catch (error) {
                    console.error('Errore nel salvare la transazione:', error);
                    showNotification('Errore nel salvare la transazione. Riprova.', 'error');
                } finally {
                    if (submitBtn) {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                }
            }, 300);
        }

        function deleteTransaction(id) {
            if (!id) return;
            
            if (confirm('Sei sicuro di voler eliminare questa transazione?')) {
                appData.transactions = appData.transactions.filter(t => t.id !== id);
                saveData();
                updateDashboard();
                renderAllTransactions();
                showNotification('Transazione eliminata', 'info');
            }
        }

        // Search and Filter - Ottimizzato con debouncing
        function searchTransactions() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchInput = document.getElementById('transaction-search');
                const categoryFilter = document.getElementById('category-filter');
                const typeFilter = document.getElementById('type-filter');
                
                const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
                const categoryValue = categoryFilter ? categoryFilter.value : '';
                const typeValue = typeFilter ? typeFilter.value : '';
                
                renderAllTransactions(categoryValue, typeValue, searchTerm);
            }, 300);
        }

        function filterTransactions() {
            const searchInput = document.getElementById('transaction-search');
            const categoryFilter = document.getElementById('category-filter');
            const typeFilter = document.getElementById('type-filter');
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const categoryValue = categoryFilter ? categoryFilter.value : '';
            const typeValue = typeFilter ? typeFilter.value : '';
            
            renderAllTransactions(categoryValue, typeValue, searchTerm);
        }

        function populateCategoryFilters() {
            const categoryFilter = document.getElementById('category-filter');
            if (!categoryFilter) return;
            
            const allCategories = [...new Set(appData.transactions.map(t => t.category))];
            
            categoryFilter.innerHTML = '<option value="">Tutte le categorie</option>';
            const fragment = document.createDocumentFragment();
            
            allCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                fragment.appendChild(option);
            });
            
            categoryFilter.appendChild(fragment);
        }

        function renderAllTransactions(categoryFilter = '', typeFilter = '', searchTerm = '') {
            const container = document.getElementById('all-transactions');
            if (!container) return;
            
            let transactions = [...appData.transactions];
            
            // Apply filters
            if (categoryFilter) {
                transactions = transactions.filter(t => t.category === categoryFilter);
            }
            if (typeFilter) {
                transactions = transactions.filter(t => t.type === typeFilter);
            }
            if (searchTerm) {
                transactions = transactions.filter(t => 
                    t.description.toLowerCase().includes(searchTerm) ||
                    t.category.toLowerCase().includes(searchTerm)
                );
            }
            
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-center">Nessuna transazione trovata.</p>';
                return;
            }
            
            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();
            
            transactions.forEach((transaction, index) => {
                const transactionElement = document.createElement('div');
                transactionElement.className = 'transaction-item slide-in-left gpu-accelerated';
                transactionElement.style.animationDelay = `${index * 0.03}s`;
                
                const transactionJson = JSON.stringify(transaction).replace(/"/g, '&quot;');
                transactionElement.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-details">
                            <h4>${transaction.description}</h4>
                            <div class="transaction-meta">
                                ${transaction.category} • ${formatDateRelative(transaction.date)}
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="transaction-amount ${transaction.amount >= 0 ? 'stat-positive' : 'stat-negative'}">
                            ${formatCurrency(transaction.amount)}
                        </div>
                        <div class="transaction-actions mt-4">
                            <button class="btn btn-sm btn-secondary" onclick="openTransactionModal('${transaction.type}', ${transactionJson})" title="Modifica">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTransaction('${transaction.id}')" title="Elimina">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                fragment.appendChild(transactionElement);
            });
            
            container.innerHTML = '';
            container.appendChild(fragment);
        }

        function renderRecentTransactions() {
            const container = document.getElementById('recent-transactions');
            if (!container) return;
            
            const recentTransactions = appData.transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentTransactions.length === 0) {
                container.innerHTML = '<p class="text-center">Nessuna transazione ancora. Aggiungi la prima!</p>';
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            recentTransactions.forEach((transaction, index) => {
                const transactionElement = document.createElement('div');
                transactionElement.className = 'transaction-item slide-in-right gpu-accelerated';
                transactionElement.style.animationDelay = `${index * 0.1}s`;
                transactionElement.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-icon" style="background: ${CATEGORY_COLORS[transaction.category] || '#3b82f6'}">
                            <i class="fas fa-${transaction.type === 'income' ? 'arrow-up' : 'arrow-down'}"></i>
                        </div>
                        <div class="transaction-details">
                            <h4>${transaction.description}</h4>
                            <div class="transaction-meta">
                                ${transaction.category} • ${formatDateRelative(transaction.date)}
                            </div>
                        </div>
                    </div>
                    <div class="transaction-amount ${transaction.amount >= 0 ? 'stat-positive' : 'stat-negative'}">
                        ${formatCurrency(transaction.amount)}
                    </div>
                `;
                fragment.appendChild(transactionElement);
            });
            
            container.innerHTML = '';
            container.appendChild(fragment);
        }

        // Goals Management - Complete Implementation
        function handleGoalSubmit(e) {
            if (e) e.preventDefault();
            
            const submitBtn = e ? e.target.querySelector('button[type="submit"]') : null;
            const originalText = submitBtn ? submitBtn.innerHTML : '';
            
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
                submitBtn.disabled = true;
            }
            
            setTimeout(() => {
                try {
                    const idInput = document.getElementById('goal-id');
                    const nameInput = document.getElementById('goal-name');
                    const targetInput = document.getElementById('goal-target');
                    const dateInput = document.getElementById('goal-date');
                    const descInput = document.getElementById('goal-description');
                    
                    if (!nameInput || !targetInput || !dateInput) {
                        throw new Error('Campi del form mancanti');
                    }
                    
                    const id = idInput ? idInput.value : '';
                    const name = nameInput.value;
                    const target = parseFloat(targetInput.value);
                    const date = dateInput.value;
                    const description = descInput ? descInput.value : '';
                    
                    if (!name || isNaN(target) || target <= 0 || !date) {
                        throw new Error('Dati del form non validi');
                    }
                    
                    const goal = {
                        id: id || generateId(),
                        name,
                        target,
                        current: 0,
                        date,
                        description,
                        createdAt: new Date().toISOString()
                    };
                    
                    if (id) {
                        const index = appData.goals.findIndex(g => g.id === id);
                        if (index !== -1) {
                            goal.current = appData.goals[index].current; // Mantieni il progresso attuale
                            appData.goals[index] = goal;
                        }
                    } else {
                        appData.goals.push(goal);
                    }
                    
                    saveData();
                    renderGoals();
                    closeModal('goal-modal');
                    
                    showNotification(`Obiettivo ${id ? 'aggiornato' : 'creato'} con successo!`, 'success');
                    
                } catch (error) {
                    console.error('Errore nel salvare l\'obiettivo:', error);
                    showNotification('Errore nel salvare l\'obiettivo. Riprova.', 'error');
                } finally {
                    if (submitBtn) {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                }
            }, 300);
        }

        // Custom amount function for goals
        function addCustomAmount(goalId, isSubtraction) {
            const input = document.getElementById(`custom-amount-${goalId}`);
            if (!input) return;
            
            const amount = parseFloat(input.value);
            if (isNaN(amount) || amount <= 0) {
                showNotification('Inserisci un importo valido maggiore di zero', 'error');
                return;
            }
            
            const finalAmount = isSubtraction ? -amount : amount;
            updateGoalProgress(goalId, finalAmount);
            
            // Clear input after use
            input.value = '';
        }

        function updateGoalProgress(goalId, amount) {
            const goal = appData.goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const newAmount = goal.current + amount;
            if (newAmount < 0) {
                showNotification('Il progresso non può essere negativo', 'error');
                return;
            }
            
            goal.current = newAmount;
            saveData();
            renderGoals();
            
            const action = amount > 0 ? 'aggiunto a' : 'rimosso da';
            showNotification(`${formatCurrency(Math.abs(amount))} ${action} "${goal.name}"`, 'success');
        }

        function deleteGoal(goalId) {
            if (!goalId) return;
            
            if (confirm('Sei sicuro di voler eliminare questo obiettivo?')) {
                appData.goals = appData.goals.filter(g => g.id !== goalId);
                saveData();
                renderGoals();
                showNotification('Obiettivo eliminato', 'info');
            }
        }

        function renderGoals() {
            const container = document.getElementById('goals-container');
            if (!container) return;
            
            if (appData.goals.length === 0) {
                container.innerHTML = '<p class="text-center">Nessun obiettivo impostato. Crea il primo!</p>';
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            appData.goals.forEach((goal, index) => {
                const progress = Math.min((goal.current / goal.target) * 100, 100);
                const remaining = Math.max(goal.target - goal.current, 0);
                const targetDate = new Date(goal.date);
                const today = new Date();
                const daysRemaining = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
                
                let status = 'in-progress';
                let statusText = 'In corso';
                if (progress >= 100) {
                    status = 'completed';
                    statusText = 'Completato';
                } else if (daysRemaining < 0) {
                    status = 'expired';
                    statusText = 'Scaduto';
                }
                
                const goalElement = document.createElement('div');
                goalElement.className = 'goal-card slide-in-left gpu-accelerated';
                goalElement.style.animationDelay = `${index * 0.1}s`;
                goalElement.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">
                            <i class="fas fa-bullseye"></i>
                            ${goal.name}
                            <div class="goal-status ${status}">
                                <i class="fas fa-${status === 'completed' ? 'check' : status === 'expired' ? 'times' : 'clock'}"></i>
                                ${statusText}
                            </div>
                        </div>
                    </div>
                    <div class="goal-body">
                        <div class="goal-progress-section">
                            <div class="goal-progress-header">
                                <div class="goal-amounts">
                                    <span>${formatCurrency(goal.current)} / ${formatCurrency(goal.target)}</span>
                                </div>
                                <div class="goal-percentage">${Math.round(progress)}%</div>
                            </div>
                            <div class="enhanced-progress-bar">
                                <div class="enhanced-progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="goal-details">
                                <div class="goal-detail-item">
                                    <div class="goal-detail-value stat-negative">${formatCurrency(remaining)}</div>
                                    <div class="goal-detail-label">Rimanente</div>
                                </div>
                                <div class="goal-detail-item">
                                    <div class="goal-detail-value ${daysRemaining >= 0 ? 'stat-neutral' : 'stat-negative'}">
                                        ${daysRemaining >= 0 ? daysRemaining : Math.abs(daysRemaining)} giorni
                                    </div>
                                    <div class="goal-detail-label">${daysRemaining >= 0 ? 'Rimanenti' : 'In ritardo'}</div>
                                </div>
                            </div>
                            ${goal.description ? `<p style="color: var(--text-secondary); margin-bottom: 1rem;">${goal.description}</p>` : ''}
                        </div>
                        <div class="goal-actions">
                            <button class="amount-btn" onclick="updateGoalProgress('${goal.id}', 50)">
                                <i class="fas fa-plus"></i> +€50
                            </button>
                            <button class="amount-btn" onclick="updateGoalProgress('${goal.id}', 100)">
                                <i class="fas fa-plus"></i> +€100
                            </button>
                            <button class="amount-btn" onclick="updateGoalProgress('${goal.id}', 500)">
                                <i class="fas fa-plus"></i> +€500
                            </button>
                            <button class="amount-btn negative" onclick="updateGoalProgress('${goal.id}', -50)">
                                <i class="fas fa-minus"></i> -€50
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="openGoalModal(${JSON.stringify(goal).replace(/"/g, '&quot;')})">
                                <i class="fas fa-edit"></i> Modifica
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGoal('${goal.id}')">
                                <i class="fas fa-trash"></i> Elimina
                            </button>
                        </div>
                    </div>
                `;
                
                fragment.appendChild(goalElement);
            });
            
            container.innerHTML = '';
            container.appendChild(fragment);
        }

        // Dashboard Update Functions
        function updateDashboard() {
            updateStats();
            renderRecentTransactions();
            updateAIInsights();
        }

        function updateStats() {
            const totalIncome = appData.transactions
                .filter(t => t.amount > 0)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpenses = Math.abs(appData.transactions
                .filter(t => t.amount < 0)
                .reduce((sum, t) => sum + t.amount, 0));
            
            const totalBalance = appData.initialBalance + totalIncome - totalExpenses;
            
            // Update DOM elements
            const elements = {
                'initial-balance-display': appData.initialBalance,
                'total-income': totalIncome,
                'total-expenses': totalExpenses,
                'total-balance': totalBalance
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = formatCurrency(value);
                    
                    // Add animation class for visual feedback
                    element.classList.add('bounce-in');
                    setTimeout(() => element.classList.remove('bounce-in'), 800);
                }
            });
        }

        // AI Insights Function
        function generateAIInsights() {
            const insights = document.getElementById('ai-insights');
            if (!insights) return;
            
            if (appData.transactions.length === 0) {
                insights.innerHTML = 'Aggiungi alcune transazioni per ricevere insights personalizzati sui tuoi comportamenti finanziari.';
                return;
            }
            
            // Calculate insights
            const totalIncome = appData.transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = Math.abs(appData.transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            const savingsRate = totalIncome > 0 ? ((totalIncome - totalExpenses) / totalIncome * 100) : 0;
            
            // Category analysis
            const expensesByCategory = {};
            appData.transactions.filter(t => t.amount < 0).forEach(t => {
                expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + Math.abs(t.amount);
            });
            
            const topCategory = Object.keys(expensesByCategory).reduce((a, b) => 
                expensesByCategory[a] > expensesByCategory[b] ? a : b, '');
            
            // Recent spending pattern
            const last7Days = appData.transactions.filter(t => {
                const transDate = new Date(t.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return transDate >= weekAgo;
            });
            
            const recentSpending = Math.abs(last7Days.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            const avgDailySpending = recentSpending / 7;
            
            // Generate insights
            let insightText = '<div style="line-height: 1.8;">';
            
            if (savingsRate > 20) {
                insightText += `<p><i class="fas fa-thumbs-up" style="color: var(--accent-color);"></i> <strong>Ottimo controllo finanziario!</strong> Stai risparmiando il ${savingsRate.toFixed(1)}% delle tue entrate.</p>`;
            } else if (savingsRate > 0) {
                insightText += `<p><i class="fas fa-chart-line" style="color: var(--warning-color);"></i> Stai risparmiando il ${savingsRate.toFixed(1)}% delle entrate. Considera di ridurre alcune spese per migliorare.</p>`;
            } else {
                insightText += `<p><i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i> <strong>Attenzione:</strong> Stai spendendo più di quanto guadagni. È importante rivedere il budget.</p>`;
            }
            
            if (topCategory) {
                const categorySpending = expensesByCategory[topCategory];
                const categoryPercentage = (categorySpending / totalExpenses * 100).toFixed(1);
                insightText += `<p><i class="fas fa-chart-pie" style="color: var(--primary-light);"></i> La tua categoria di spesa principale è <strong>${topCategory}</strong> (${categoryPercentage}% del totale, ${formatCurrency(categorySpending)}).</p>`;
            }
            
            if (avgDailySpending > 0) {
                insightText += `<p><i class="fas fa-calendar-day" style="color: var(--accent-color);"></i> Negli ultimi 7 giorni hai speso in media ${formatCurrency(avgDailySpending)} al giorno.</p>`;
            }
            
            // Goals insight
            if (appData.goals.length > 0) {
                const activeGoals = appData.goals.filter(g => {
                    const progress = (g.current / g.target) * 100;
                    return progress < 100;
                });
                
                if (activeGoals.length > 0) {
                    insightText += `<p><i class="fas fa-target" style="color: var(--primary-color);"></i> Hai ${activeGoals.length} obiettivi attivi. Con la tua attuale capacità di risparmio, potresti raggiungerli più velocemente!</p>`;
                }
            }
            
            insightText += '</div>';
            insights.innerHTML = insightText;
            
            showNotification('Insights AI generati con successo!', 'success');
        }

        function updateAIInsights() {
            // Auto-generate insights when data changes
            if (appData.transactions.length > 0) {
                generateAIInsights();
            }
        }

        // Calendar Functions
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const currentMonthElement = document.getElementById('current-month');
            
            if (!calendarGrid || !currentMonthElement) return;
            
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            // Update month display
            currentMonthElement.textContent = new Intl.DateTimeFormat('it-IT', { 
                month: 'long', 
                year: 'numeric' 
            }).format(currentMonth);
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = (firstDay.getDay() + 6) % 7; // Make Monday = 0
            const numberOfDays = lastDay.getDate();
            
            // Get transactions for this month
            const monthTransactions = appData.transactions.filter(t => {
                const transDate = new Date(t.date);
                return transDate.getFullYear() === year && transDate.getMonth() === month;
            });
            
            // Group transactions by day
            const transactionsByDay = {};
            monthTransactions.forEach(t => {
                const day = new Date(t.date).getDate();
                if (!transactionsByDay[day]) transactionsByDay[day] = [];
                transactionsByDay[day].push(t);
            });
            
            // Clear calendar
            calendarGrid.innerHTML = '';
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startingDay; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.opacity = '0.3';
                calendarGrid.appendChild(dayElement);
            }
            
            // Add days of the month
            for (let day = 1; day <= numberOfDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                let dayHTML = `<div class="calendar-day-number">${day}</div>`;
                
                if (transactionsByDay[day]) {
                    transactionsByDay[day].slice(0, 3).forEach((transaction, index) => {
                        dayHTML += `
                            <div class="calendar-event" style="background: ${CATEGORY_COLORS[transaction.category] || '#3b82f6'}; animation-delay: ${index * 0.1}s">
                                ${transaction.description.substring(0, 15)}${transaction.description.length > 15 ? '...' : ''}
                            </div>
                        `;
                    });
                    
                    if (transactionsByDay[day].length > 3) {
                        dayHTML += `<div class="calendar-event" style="background: var(--text-muted);">+${transactionsByDay[day].length - 3} altre</div>`;
                    }
                }
                
                dayElement.innerHTML = dayHTML;
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            renderCalendar();
        }

        // Analytics Functions
        function updateCharts() {
            requestAnimationFrame(() => {
                updateMonthlyChart();
                updateCategoryChart();
                updateIncomeExpenseChart();
            });
        }

        function updateMonthlyChart() {
            const canvas = document.getElementById('monthly-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart
            if (charts.monthlyChart) {
                charts.monthlyChart.destroy();
            }
            
            // Prepare data - last 12 months
            const months = [];
            const incomeData = [];
            const expenseData = [];
            
            for (let i = 11; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const year = date.getFullYear();
                const month = date.getMonth();
                
                months.push(new Intl.DateTimeFormat('it-IT', { month: 'short' }).format(date));
                
                const monthTransactions = appData.transactions.filter(t => {
                    const transDate = new Date(t.date);
                    return transDate.getFullYear() === year && transDate.getMonth() === month;
                });
                
                const income = monthTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
                const expenses = Math.abs(monthTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
                
                incomeData.push(income);
                expenseData.push(expenses);
            }
            
            charts.monthlyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Entrate',
                        data: incomeData,
                        borderColor: '#06d6a0',
                        backgroundColor: 'rgba(6, 214, 160, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Spese',
                        data: expenseData,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#f8fafc' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        },
                        y: {
                            ticks: { 
                                color: '#e2e8f0',
                                callback: function(value) {
                                    return '€' + value.toLocaleString('it-IT');
                                }
                            },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        }
                    }
                }
            });
        }

        function updateCategoryChart() {
            const canvas = document.getElementById('category-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart
            if (charts.categoryChart) {
                charts.categoryChart.destroy();
            }
            
            // Prepare expense data by category
            const expensesByCategory = {};
            appData.transactions.filter(t => t.amount < 0).forEach(t => {
                expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + Math.abs(t.amount);
            });
            
            const categories = Object.keys(expensesByCategory);
            const amounts = Object.values(expensesByCategory);
            const colors = categories.map(cat => CATEGORY_COLORS[cat] || '#8b5cf6');
            
            if (categories.length === 0) {
                ctx.fillStyle = '#e2e8f0';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Nessuna spesa registrata', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            charts.categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: amounts,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { 
                                color: '#f8fafc',
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        function updateIncomeExpenseChart() {
            const canvas = document.getElementById('income-expense-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart
            if (charts.incomeExpenseChart) {
                charts.incomeExpenseChart.destroy();
            }
            
            const totalIncome = appData.transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = Math.abs(appData.transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            
            charts.incomeExpenseChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Entrate', 'Spese', 'Differenza'],
                    datasets: [{
                        data: [totalIncome, totalExpenses, totalIncome - totalExpenses],
                        backgroundColor: ['#06d6a0', '#ef4444', totalIncome >= totalExpenses ? '#06d6a0' : '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        },
                        y: {
                            ticks: { 
                                color: '#e2e8f0',
                                callback: function(value) {
                                    return '€' + value.toLocaleString('it-IT');
                                }
                            },
                            grid: { color: 'rgba(75, 85, 99, 0.2)' }
                        }
                    }
                }
            });
        }

        // Export Function
        function exportData() {
            const data = {
                exported_at: new Date().toISOString(),
                initial_balance: appData.initialBalance,
                transactions: appData.transactions,
                goals: appData.goals,
                settings: appData.settings
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `financeai-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Dati esportati con successo!', 'success');
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            // ESC to close modals
            if (e.key === 'Escape') {
                const activeModal = document.querySelector('.modal.active');
                if (activeModal) {
                    closeModal(activeModal.id);
                }
            }
            
            // Quick actions with Ctrl/Cmd key
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showTab('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        showTab('transactions');
                        break;
                    case '3':
                        e.preventDefault();
                        showTab('analytics');
                        break;
                    case '4':
                        e.preventDefault();
                        showTab('calendar');
                        break;
                    case '5':
                        e.preventDefault();
                        showTab('goals');
                        break;
                    case 'n':
                        e.preventDefault();
                        showQuickActions();
                        break;
                }
            }
        });

        // Enhanced form validation
        function validateTransactionForm() {
            const description = document.getElementById('transaction-description').value.trim();
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const date = document.getElementById('transaction-date').value;
            const category = document.getElementById('transaction-category').value;
            
            const errors = [];
            
            if (!description || description.length < 2) {
                errors.push('La descrizione deve essere di almeno 2 caratteri');
            }
            if (isNaN(amount) || amount <= 0 || amount > 999999) {
                errors.push('L\'importo deve essere un numero positivo valido (max €999,999)');
            }
            if (!date) {
                errors.push('La data è obbligatoria');
            } else {
                const transDate = new Date(date);
                const today = new Date();
                const oneYearAgo = new Date();
                const oneYearFromNow = new Date();
                oneYearAgo.setFullYear(today.getFullYear() - 1);
                oneYearFromNow.setFullYear(today.getFullYear() + 1);
                
                if (transDate < oneYearAgo || transDate > oneYearFromNow) {
                    errors.push('La data deve essere compresa tra un anno fa e un anno nel futuro');
                }
            }
            if (!category) {
                errors.push('La categoria è obbligatoria');
            }
            
            return errors;
        }

        function validateGoalForm() {
            const name = document.getElementById('goal-name').value.trim();
            const target = parseFloat(document.getElementById('goal-target').value);
            const date = document.getElementById('goal-date').value;
            
            const errors = [];
            
            if (!name || name.length < 2) {
                errors.push('Il nome deve essere di almeno 2 caratteri');
            }
            if (isNaN(target) || target <= 0 || target > 9999999) {
                errors.push('L\'importo target deve essere un numero positivo valido (max €9,999,999)');
            }
            if (!date) {
                errors.push('La data obiettivo è obbligatoria');
            } else {
                const goalDate = new Date(date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (goalDate < today) {
                    errors.push('La data obiettivo deve essere nel futuro');
                }
            }
            
            return errors;
        }

        // Enhanced error handling and performance optimizations
        function handleTransactionSubmit(e) {
            if (e) e.preventDefault();
            
            const errors = validateTransactionForm();
            if (errors.length > 0) {
                showNotification(errors.join('<br>'), 'error');
                return;
            }
            
            const submitBtn = e ? e.target.querySelector('button[type="submit"]') : null;
            const originalText = submitBtn ? submitBtn.innerHTML : '';
            
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
                submitBtn.disabled = true;
            }
            
            // Use requestAnimationFrame for smooth UI updates
            requestAnimationFrame(() => {
                setTimeout(() => {
                    try {
                        const idInput = document.getElementById('transaction-id');
                        const typeInput = document.getElementById('transaction-type');
                        const descInput = document.getElementById('transaction-description');
                        const amountInput = document.getElementById('transaction-amount');
                        const dateInput = document.getElementById('transaction-date');
                        const categoryInput = document.getElementById('transaction-category');
                        
                        const id = idInput ? idInput.value : '';
                        const type = typeInput.value;
                        const description = descInput.value.trim();
                        const amount = parseFloat(amountInput.value);
                        const date = dateInput.value;
                        const category = categoryInput.value;
                        
                        const transaction = {
                            id: id || generateId(),
                            type,
                            description,
                            amount: type === 'expense' ? -Math.abs(amount) : Math.abs(amount),
                            date,
                            category,
                            createdAt: new Date().toISOString()
                        };
                        
                        if (id) {
                            const index = appData.transactions.findIndex(t => t.id === id);
                            if (index !== -1) {
                                appData.transactions[index] = transaction;
                            }
                        } else {
                            appData.transactions.push(transaction);
                        }
                        
                        saveData();
                        
                        // Batch DOM updates for better performance
                        requestAnimationFrame(() => {
                            updateDashboard();
                            if (currentTab === 'transactions') {
                                renderAllTransactions();
                            }
                        });
                        
                        closeModal('transaction-modal');
                        showNotification(`Transazione ${id ? 'aggiornata' : 'aggiunta'} con successo!`, 'success');
                        
                    } catch (error) {
                        console.error('Errore nel salvare la transazione:', error);
                        showNotification('Errore nel salvare la transazione. Riprova.', 'error');
                    } finally {
                        if (submitBtn) {
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        }
                    }
                }, 200);
            });
        }

        function handleGoalSubmit(e) {
            if (e) e.preventDefault();
            
            const errors = validateGoalForm();
            if (errors.length > 0) {
                showNotification(errors.join('<br>'), 'error');
                return;
            }
            
            const submitBtn = e ? e.target.querySelector('button[type="submit"]') : null;
            const originalText = submitBtn ? submitBtn.innerHTML : '';
            
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
                submitBtn.disabled = true;
            }
            
            requestAnimationFrame(() => {
                setTimeout(() => {
                    try {
                        const idInput = document.getElementById('goal-id');
                        const nameInput = document.getElementById('goal-name');
                        const targetInput = document.getElementById('goal-target');
                        const dateInput = document.getElementById('goal-date');
                        const descInput = document.getElementById('goal-description');
                        
                        const id = idInput ? idInput.value : '';
                        const name = nameInput.value.trim();
                        const target = parseFloat(targetInput.value);
                        const date = dateInput.value;
                        const description = descInput ? descInput.value.trim() : '';
                        
                        const goal = {
                            id: id || generateId(),
                            name,
                            target,
                            current: 0,
                            date,
                            description,
                            createdAt: new Date().toISOString()
                        };
                        
                        if (id) {
                            const index = appData.goals.findIndex(g => g.id === id);
                            if (index !== -1) {
                                goal.current = appData.goals[index].current;
                                appData.goals[index] = goal;
                            }
                        } else {
                            appData.goals.push(goal);
                        }
                        
                        saveData();
                        
                        requestAnimationFrame(() => {
                            renderGoals();
                        });
                        
                        closeModal('goal-modal');
                        showNotification(`Obiettivo ${id ? 'aggiornato' : 'creato'} con successo!`, 'success');
                        
                    } catch (error) {
                        console.error('Errore nel salvare l\'obiettivo:', error);
                        showNotification('Errore nel salvare l\'obiettivo. Riprova.', 'error');
                    } finally {
                        if (submitBtn) {
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        }
                    }
                }, 200);
            });
        }

        // Performance-optimized data caching
        let cachedStats = null;
        let lastStatsUpdate = 0;
        const STATS_CACHE_DURATION = 5000; // 5 seconds

        function getStats() {
            const now = Date.now();
            if (cachedStats && (now - lastStatsUpdate) < STATS_CACHE_DURATION) {
                return cachedStats;
            }
            
            const totalIncome = appData.transactions
                .filter(t => t.amount > 0)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpenses = Math.abs(appData.transactions
                .filter(t => t.amount < 0)
                .reduce((sum, t) => sum + t.amount, 0));
            
            const totalBalance = appData.initialBalance + totalIncome - totalExpenses;
            
            cachedStats = { totalIncome, totalExpenses, totalBalance };
            lastStatsUpdate = now;
            
            return cachedStats;
        }

        function updateStats() {
            const stats = getStats();
            
            const elements = {
                'initial-balance-display': appData.initialBalance,
                'total-income': stats.totalIncome,
                'total-expenses': stats.totalExpenses,
                'total-balance': stats.totalBalance
            };
            
            // Batch DOM updates
            requestAnimationFrame(() => {
                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        const oldValue = parseFloat(element.textContent.replace(/[^\d.-]/g, '')) || 0;
                        const newValue = value;
                        
                        element.textContent = formatCurrency(newValue);
                        
                        // Animate if value changed significantly
                        if (Math.abs(oldValue - newValue) > 0.01) {
                            element.classList.add('bounce-in');
                            setTimeout(() => element.classList.remove('bounce-in'), 800);
                        }
                    }
                });
            });
        }

        // Lazy loading for charts
        let chartsInitialized = false;
        
        function initializeChartsIfNeeded() {
            if (!chartsInitialized && currentTab === 'analytics') {
                chartsInitialized = true;
                updateCharts();
            }
        }

        // Enhanced tab management with lazy loading
        function showTab(tabName, clickedElement) {
            if (!tabName || currentTab === tabName) return;
            
            const container = document.querySelector('.container');
            if (container) {
                container.style.opacity = '0.8';
            }
            
            requestAnimationFrame(() => {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });
                
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                const targetTab = document.getElementById(tabName + '-tab');
                if (targetTab) {
                    targetTab.classList.remove('hidden');
                }
                
                if (clickedElement) {
                    clickedElement.classList.add('active');
                }
                
                currentTab = tabName;
                
                // Lazy initialization based on tab
                setTimeout(() => {
                    switch(tabName) {
                        case 'analytics':
                            initializeChartsIfNeeded();
                            break;
                        case 'calendar':
                            renderCalendar();
                            break;
                        case 'goals':
                            renderGoals();
                            break;
                        case 'transactions':
                            renderAllTransactions();
                            populateCategoryFilters();
                            break;
                        case 'dashboard':
                            updateDashboard();
                            loadInitialBalance();
                            break;
                    }
                    
                    if (container) {
                        container.style.opacity = '1';
                    }
                }, 50);
            });
        }

        // Enhanced AI insights with more intelligent analysis
        function generateAIInsights() {
            const insights = document.getElementById('ai-insights');
            if (!insights) return;
            
            if (appData.transactions.length === 0) {
                insights.innerHTML = `
                    <div style="line-height: 1.8; text-align: center;">
                        <i class="fas fa-lightbulb" style="color: var(--accent-color); font-size: 2rem; display: block; margin-bottom: 1rem;"></i>
                        <p>Aggiungi alcune transazioni per ricevere insights personalizzati e consigli intelligenti sui tuoi comportamenti finanziari.</p>
                    </div>
                `;
                return;
            }
            
            const stats = getStats();
            const { totalIncome, totalExpenses, totalBalance } = stats;
            const savingsRate = totalIncome > 0 ? ((totalIncome - totalExpenses) / totalIncome * 100) : 0;
            
            // Advanced category analysis
            const expensesByCategory = {};
            appData.transactions.filter(t => t.amount < 0).forEach(t => {
                expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + Math.abs(t.amount);
            });
            
            const topCategories = Object.entries(expensesByCategory)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);
            
            // Spending trends analysis
            const last30Days = appData.transactions.filter(t => {
                const transDate = new Date(t.date);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return transDate >= thirtyDaysAgo;
            });
            
            const last30Income = last30Days.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const last30Expenses = Math.abs(last30Days.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            
            // Generate comprehensive insights
            let insightText = '<div style="line-height: 1.8;">';
            
            // Financial health assessment
            if (savingsRate > 30) {
                insightText += `<p><i class="fas fa-medal" style="color: var(--accent-color);"></i> <strong>Eccellente gestione finanziaria!</strong> Stai risparmiando il ${savingsRate.toFixed(1)}% delle tue entrate. Sei sulla strada giusta per raggiungere i tuoi obiettivi.</p>`;
            } else if (savingsRate > 15) {
                insightText += `<p><i class="fas fa-thumbs-up" style="color: var(--success-color);"></i> <strong>Buon controllo finanziario!</strong> Stai risparmiando il ${savingsRate.toFixed(1)}% delle entrate. Considera di aumentare leggermente il risparmio.</p>`;
            } else if (savingsRate > 0) {
                insightText += `<p><i class="fas fa-chart-line" style="color: var(--warning-color);"></i> Stai risparmiando il ${savingsRate.toFixed(1)}% delle entrate. C'è margine di miglioramento per una maggiore sicurezza finanziaria.</p>`;
            } else {
                insightText += `<p><i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i> <strong>Attenzione:</strong> Stai spendendo più di quanto guadagni. È importante rivedere il budget e ridurre le spese non essenziali.</p>`;
            }
            
            // Category insights
            if (topCategories.length > 0) {
                const [topCategory, topAmount] = topCategories[0];
                const categoryPercentage = (topAmount / totalExpenses * 100).toFixed(1);
                insightText += `<p><i class="fas fa-chart-pie" style="color: var(--primary-light);"></i> La tua categoria di spesa principale è <strong>${topCategory}</strong> (${categoryPercentage}% del totale, ${formatCurrency(topAmount)}). `;
                
                if (categoryPercentage > 40) {
                    insightText += `Considera di bilanciare meglio le spese.</p>`;
                } else {
                    insightText += `Un buon equilibrio nelle spese.</p>`;
                }
            }
            
            // Monthly trend analysis
            if (last30Days.length > 0) {
                const monthlyBalance = last30Income - last30Expenses;
                insightText += `<p><i class="fas fa-calendar-month" style="color: var(--accent-color);"></i> Negli ultimi 30 giorni: ${formatCurrency(last30Income)} entrate, ${formatCurrency(last30Expenses)} spese. `;
                insightText += `Bilancio mensile: <strong style="color: ${monthlyBalance >= 0 ? 'var(--success-color)' : 'var(--danger-color)'}">${formatCurrency(monthlyBalance)}</strong></p>`;
            }
            
            // Goals insight
            if (appData.goals.length > 0) {
                const activeGoals = appData.goals.filter(g => (g.current / g.target) < 1);
                const avgProgress = appData.goals.reduce((sum, g) => sum + (g.current / g.target), 0) / appData.goals.length * 100;
                
                insightText += `<p><i class="fas fa-target" style="color: var(--primary-color);"></i> Hai ${appData.goals.length} obiettivi con progresso medio del ${avgProgress.toFixed(1)}%. `;
                
                if (savingsRate > 10 && activeGoals.length > 0) {
                    const monthlySavings = totalIncome * (savingsRate / 100);
                    const avgGoalAmount = activeGoals.reduce((sum, g) => sum + (g.target - g.current), 0) / activeGoals.length;
                    const monthsToGoal = Math.ceil(avgGoalAmount / monthlySavings);
                    insightText += `Con il tuo tasso di risparmio attuale, potresti raggiungere un obiettivo medio in circa ${monthsToGoal} mesi.</p>`;
                } else {
                    insightText += `Aumenta il risparmio per raggiungere più velocemente i tuoi obiettivi!</p>`;
                }
            }
            
            // Personalized recommendations
            insightText += '<hr style="margin: 1.5rem 0; border: none; height: 1px; background: rgba(255,255,255,0.1);">';
            insightText += '<p><i class="fas fa-robot" style="color: var(--accent-color);"></i> <strong>Consigli personalizzati:</strong></p>';
            insightText += '<ul style="margin-left: 1.5rem; line-height: 2;">';
            
            if (savingsRate < 20) {
                insightText += '<li>Prova la regola 50/30/20: 50% bisogni essenziali, 30% desideri, 20% risparmi</li>';
            }
            if (topCategories.length > 0 && topCategories[0][1] > totalIncome * 0.3) {
                insightText += `<li>La spesa in ${topCategories[0][0]} è alta. Cerca alternative per ridurre questi costi</li>`;
            }
            if (appData.goals.length === 0) {
                insightText += '<li>Imposta degli obiettivi di risparmio per motivarti e tracciare i progressi</li>';
            }
            
            insightText += '</ul></div>';
            insights.innerHTML = insightText;
            
            showNotification('Insights AI aggiornati con analisi avanzata!', 'success');
        }

        // Initialize App with error handling
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Clear any cached data
                cachedStats = null;
                lastStatsUpdate = 0;
                
                // Load initial data
                loadInitialBalance();
                updateDashboard();
                
                // Initialize current tab
                showTab('dashboard');
                
                // Remove any debug output
                const debugElements = document.querySelectorAll('.debug, [data-debug]');
                debugElements.forEach(el => el.remove());
                
            } catch (error) {
                console.error('Errore nell\'inizializzazione:', error);
                showNotification('Errore nell\'inizializzazione dell\'applicazione', 'error');
            }
        });

        // Clean console output - remove development logs
        if (typeof console !== 'undefined') {
            const originalLog = console.log;
            console.log = function(...args) {
                // Only log errors in production
                if (args.some(arg => typeof arg === 'string' && arg.includes('Errore'))) {
                    originalLog.apply(console, args);
                }
            };
        }
    </script>
</body>
</html>-icon" style="background: ${CATEGORY_COLORS[transaction.category] || '#3b82f6'}">
                            <i class="fas fa-${transaction.type === 'income' ? 'arrow-up' : 'arrow-down'}"></i>
                        </div>
                        <div class="transaction
